<html>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Aneureka" />
  <meta name="description" content="è¦æŠ€è‰ºè¶…ç¾¤ï¼Œè¦äºˆäººæ¸©æš–ã€‚" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta
    property="og:title"
    content="Effective Modern C++ è¯»ä¹¦ç¬”è®° Â· æ•£è½çš„å¶å­"
  />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://www.aneureka.cn/effective-modern-cpp-notes-2022-11-26/index.html" />
  <meta property="og:description" content="è¦æŠ€è‰ºè¶…ç¾¤ï¼Œè¦äºˆäººæ¸©æš–ã€‚" />
  <meta property="og:image" content="https://www.aneureka.cn/img/favicon.ico" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@Aneureka" />
  <meta name="twitter:url" content="https://www.aneureka.cn/effective-modern-cpp-notes-2022-11-26/index.html" />
  <meta name="twitter:title" content="æ•£è½çš„å¶å­" />
  <meta name="twitter:description" content="è¦æŠ€è‰ºè¶…ç¾¤ï¼Œè¦äºˆäººæ¸©æš–ã€‚" />
  <meta name="twitter:image" content="https://www.aneureka.cn/img/cover.png" />
  <title>
    Effective Modern C++ è¯»ä¹¦ç¬”è®° Â· æ•£è½çš„å¶å­
  </title>
  
  <link rel="icon" href="/img/favicon.ico" />
  <link rel="apple-touch-icon" href="/img/favicon.ico" />
  <link rel="bookmark" href="/img/favicon.ico" />
  <link rel="shortcut icon" href="/img/favicon.ico" />
  
  <link
    rel="stylesheet"
    href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css"
  />
  
<link rel="stylesheet" href="/css/blog.css">

  
<link rel="stylesheet" href="/css/global.css">

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="æ•£è½çš„å¶å­" type="application/atom+xml">
</head>

  <body>
    <div class="blog-header section">
  <nav>
    <div class="container main header">
      <a href="/">
        <img class="logo" src="/img/favicon.ico" />
      </a>
      <div class="menu">
        
        <a class="menu-item" href="/">
          <span class="menu-item-text">æ•£è½çš„å¶å­</span>
        </a>
        
      </div>
    </div>
  </nav>
</div>
 <div class="section">
  <div class="container main post">
    
    <!-- Title -->
    <h2 class="title">Effective Modern C++ è¯»ä¹¦ç¬”è®°</h2>
    <!-- Date and Author -->
    <p class="subtitle is-7 has-text-grey">
      2022-11-26 by Aneureka
    </p>
    
    <!-- Content -->
    <article class="markdown-body"><p>æœ¬ç€ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Learning_by_teaching">Learning by teaching</a> çš„åŸåˆ™ï¼Œç»“åˆç›®å‰è‡ªå·±çš„ä¸€äº›ç°ä»£ C++ å®è·µï¼Œå°å°è®°å½•ä¸€ä¸‹ã€‚èƒ½åŠ›æ‰€é™ï¼Œæœ¬æ–‡ä¸å¯é¿å…åœ°ä¼šæœ‰è€ƒè™‘ä¸å‘¨çš„åœ°æ–¹ï¼Œè¿˜è¯·å¤§å®¶å¤šå¤šæŒ‡æ­£ğŸ¤£ã€‚</p>
<h2 id="ç±»å‹æ¨å¯¼"><a href="#ç±»å‹æ¨å¯¼" class="headerlink" title="ç±»å‹æ¨å¯¼"></a>ç±»å‹æ¨å¯¼</h2><blockquote>
<p>çªå‡»æ£€æŸ¥ï¼š <code>char const *(*(* const bar)[5]) (int)</code> æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ</p>
</blockquote>
<p>ä¸è¿‡æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜ä¸æ˜¯åšç±»å‹ä½“æ“ï¼Œè€Œæ˜¯è®¨è®ºä¸€ä¸‹åœ¨å¼•å…¥ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/auto">auto</a> ã€ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/decltype">decltype</a> ç­‰å…³é”®å­—åï¼ŒC++ çš„ç±»å‹æ¨å¯¼ä¸»è¦åˆ†ä¸ºå“ªäº›ï¼Œå¦‚ä½•è¿›è¡Œã€‚</p>
<h3 id="æ¨¡æ¿ç±»å‹æ¨å¯¼"><a href="#æ¨¡æ¿ç±»å‹æ¨å¯¼" class="headerlink" title="æ¨¡æ¿ç±»å‹æ¨å¯¼"></a>æ¨¡æ¿ç±»å‹æ¨å¯¼</h3><p>C++ å‡½æ•°æ¨¡æ¿çš„ä½¿ç”¨å¯å½’ç»“ä¸ºä»¥ä¸‹å½¢å¼ï¼š</p>
<pre><code class="cpp">// å£°æ˜
template &lt;T&gt;
void f(ParamType param); // å…¶ä¸­ ParamType ä¸ºåŒ…å« T çš„ç»„åˆç±»å‹

// è°ƒç”¨
f(expr);
</code></pre>
<p>ä¾‹å¦‚å¯¹äºä»¥ä¸‹å‡½æ•°æ¨¡æ¿å’Œè°ƒç”¨è¯­å¥ï¼š</p>
<pre><code class="cpp">template &lt;T&gt;
void f(const T &amp;param);

int x = 0x114;
f(x);
</code></pre>
<p><code>T</code> å°†è¢«æ¨å¯¼ä¸º <code>int</code> ï¼Œ <code>ParamType</code> åˆ™ä¸º <code>const T &amp;</code> ã€‚</p>
<p>è¿™ä¸ªç®€å•çš„ä¾‹å­å¯èƒ½ä¼šè®©æˆ‘ä»¬è¯¯ä»¥ä¸º <code>T</code> çš„ç±»å‹ä»…ä¾èµ– <code>expr</code> ï¼Œå®é™…ä¸Šå¹¶éå¦‚æ­¤ï¼Œ <code>T</code> çš„ç±»å‹æ¨å¯¼ç»“æœè¿˜ä¾èµ–äº <code>ParamType</code> çš„å½¢å¼ï¼Œå¯æ€»ç»“ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µã€‚</p>
<p><strong>ä¸€ã€ <code>ParamType</code> æ˜¯ä¸ªæŒ‡é’ˆæˆ–å¼•ç”¨ï¼ˆä½†ä¸æ˜¯ä¸‡èƒ½å¼•ç”¨ï¼‰</strong></p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œç±»å‹æ¨å¯¼è¿‡ç¨‹éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p>
<ol>
<li><p> <code>expr</code> çš„ reference-ness ä¼šè¢«å¿½ç•¥ï¼šå¼•ç”¨çš„å¼•ç”¨è¿˜æ˜¯å¼•ç”¨ï¼ˆæƒ³èµ·äº†é˜¿å°¼äºšçš„è¡¨æƒ…åŒ…ï¼‰</p>
</li>
<li><p> <code>expr</code> çš„ constness ä¼šè¢«ä¿ç•™ï¼šå½“å‡½æ•°çš„å½¢å‚ä¸ºå¼•ç”¨ç±»å‹æ—¶ï¼Œè°ƒç”¨è€…è‚¯å®šä¸å¸Œæœ›åŸæœ¬ä¸º <code>const</code> çš„å¸¸é‡åœ¨è°ƒç”¨åè¢«ä¿®æ”¹äº†</p>
</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œ</p>
<pre><code class="cpp">template&lt;typename T&gt;
void f(T &amp;param); // ParamType ä¸º T&amp;

int x = 0x114;
const int cx = x;
const int &amp;rx = x;

f(x);   // T -&gt; int,       ParamType -&gt; int&amp;
f(cx);  // T -&gt; const int, ParamType -&gt; const int&amp;
f(rx);  // T -&gt; const int, ParamType -&gt; const int&amp;
</code></pre>
<p>å¯¹äºåŸåˆ™äºŒï¼Œå¦‚æœ <code>ParamType</code> æœ¬æ¥å°±æ˜¯ <code>const</code> å¼•ç”¨ç±»å‹ï¼Œæ­¤æ—¶ <code>T</code> å°±æ²¡å¿…è¦æ¨å¯¼ä¸º <code>const</code> ç±»å‹äº†ï¼Œä¾‹å¦‚</p>
<pre><code class="cpp">template&lt;typename T&gt;
void f(const T &amp;param);

int y = 0x514;
const int cy = y;

f(cy);  // T -&gt; int,       ParamType -&gt; const int&amp;
</code></pre>
<p>å¯¹äºæŒ‡é’ˆï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„æ¨å¯¼è¿‡ç¨‹ã€‚</p>
<p><strong>äºŒã€ <code>ParamType</code> æ˜¯ä¸ªä¸‡èƒ½å¼•ç”¨</strong></p>
<p>C++11 å¼•å…¥<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/reference#Rvalue_references">å³å€¼å¼•ç”¨</a>æ—¶ï¼Œä¹Ÿå¼•å…¥äº†<a target="_blank" rel="noopener" href="https://isocpp.org/blog/2012/11/universal-references-in-c11-scott-meyers">ä¸‡èƒ½å¼•ç”¨</a>ï¼ˆUniversal reference named by Scott Meyersï¼Œæˆ‘è‡ªå·±æ›´å€¾å‘äºç†è§£ä¸ºâ€œå‘ç”Ÿç±»å‹æ¨å¯¼å‰å¤•çš„å³å€¼å¼•ç”¨â€ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç±»å‹æ¨å¯¼è¿‡ç¨‹éµå¾ª<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/reference#Reference_collapsing">å¼•ç”¨æŠ˜å </a>ï¼ˆReference collapsingï¼‰çš„åŸåˆ™ï¼š</p>
<ol>
<li><p>å¦‚æœ <code>expr</code> ä¸ºå·¦å€¼ï¼Œ <code>T</code> å’Œ <code>ParamType</code> ä¼šè¢«æ¨å¯¼ä¸ºå·¦å€¼å¼•ç”¨ï¼ˆè¿™æ˜¯åœ¨æ¨¡æ¿ç±»å‹æ¨å¯¼ä¸­ï¼Œ <code>T</code> è¢«æ¨å¯¼ä¸ºå¼•ç”¨ç±»å‹çš„å”¯ä¸€æƒ…å½¢ï¼‰</p>
</li>
<li><p>å¦‚æœ <code>expr</code> ä¸ºå³å€¼ï¼Œåˆ™å¤ç”¨ä¸Šé¢çš„ç¬¬ä¸€ç§æƒ…å†µ</p>
</li>
</ol>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="cpp">template &lt;typename T&gt;
void f(T &amp;&amp;param);

int x = 0x114;
const int cx = x;
const int &amp;rx = x;

f(x);      // x     -&gt; lvalue =&gt; T -&gt; int&amp;,       ParamType -&gt; int&amp;
f(cx);     // cx    -&gt; lvalue =&gt; T -&gt; const int&amp;, ParamType -&gt; const int&amp; &amp;&amp; -&gt; const int &amp;
f(rx);     // rx    -&gt; lvalue =&gt; T -&gt; const int&amp;, ParamType -&gt; const int&amp; &amp;&amp; -&gt; const int &amp;
f(0x514);  // 0x514 -&gt; rvalue =&gt; T -&gt; int,        ParamType -&gt; int&amp;&amp;
</code></pre>
<p><strong>ä¸‰ã€ <code>ParamType</code> æ—¢éæŒ‡é’ˆä¹Ÿéå¼•ç”¨</strong></p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œtop-level <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/cv">CV ç±»å‹é™å®šç¬¦</a>ä¼šè¢«å¿½ç•¥ï¼Œä½†æ³¨æ„ low-level çš„ <code>constness</code> å°†è¢«ä¿ç•™ã€‚</p>
<pre><code class="cpp">template&lt;typename T&gt;
void f(T param);

const char * const ptr = &quot;Hello world&quot;;
f(ptr); // ä¿®é¥° ptr æœ¬èº«çš„ const è¢«å¿½ç•¥ï¼Œä¿®é¥° ptr æŒ‡å‘å¯¹è±¡çš„ const è¢«ä¿ç•™
        // å› æ­¤ T, ParamType å‡è¢«æ¨å¯¼ä¸º const char *
</code></pre>
<p>å¦å¤–ï¼Œæ•°ç»„å’Œå‡½æ•°åœ¨ <code>ParamType</code> ä¸ºå€¼ç±»å‹æ—¶ä¼šåˆ†åˆ«é€€åŒ–æˆæŒ‡é’ˆå’Œå‡½æ•°æŒ‡é’ˆï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="cpp">template&lt;typename T&gt;
void f(T param);

template&lt;typename T&gt;
void f_ref(T &amp;param);

const char name[] = &quot;Hello world&quot;;
f(name);     // ParamType -&gt; const char *
f_ref(name); // ParamType -&gt; const char (&amp;)[12]

void func(int);
f(func);     // ParamType -&gt; void (*)(int)
f_ref(func); // ParamType -&gt; void (&amp;)(int)
</code></pre>
<h3 id="auto-ç±»å‹æ¨å¯¼"><a href="#auto-ç±»å‹æ¨å¯¼" class="headerlink" title="auto ç±»å‹æ¨å¯¼"></a><code>auto</code> ç±»å‹æ¨å¯¼</h3><p><code>auto</code> çš„ç±»å‹æ¨å¯¼ä¸æ¨¡æ¿åŸºæœ¬ç›¸åŒï¼Œå”¯ä¸€çš„å·®å¼‚åœ¨äºå®ƒä»¬å¯¹äº <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/utility/initializer_list">std::initializer_list</a> çš„ç±»å‹æ¨å¯¼é€»è¾‘ä¸åŒã€‚</p>
<pre><code class="cpp">auto x = &#123; 0x11, 0x45, 0x14 &#125;; // x -&gt; std::initializer_list

template&lt;typename T&gt;
void f(T param);
f(&#123; 0x11, 0x45, 0x14 &#125;); // Compile errorï¼Œç±»å‹æ¨å¯¼å¤±è´¥

template&lt;typename T&gt;
void f2(std::initializer_list&lt;T&gt; param);
f2(&#123; 0x11, 0x45, 0x14 &#125;); // T -&gt; int, ParamType -&gt; std::initializer_list&lt;int&gt;

auto create_list() &#123; // auto åœ¨ C++14 ä¸­å¯ç”¨äºè¯´æ˜å‡½æ•°è¿”å›å€¼éœ€è¦æ¨å¯¼
  return &#123;1, 2, 3&#125;; // Compile errorï¼Œæ­¤æ—¶ä½¿ç”¨æ¨¡æ¿ç±»å‹æ¨å¯¼ï¼Œè€Œä¸æ˜¯ auto ç±»å‹æ¨å¯¼
&#125;
</code></pre>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ C++ 14 çš„æŸäº›åœºæ™¯ï¼Œ <code>auto</code> å…³é”®å­—ç”¨äºè¿›è¡Œæ¨¡æ¿ç±»å‹æ¨å¯¼è€Œä¸æ˜¯ <code>auto</code> ç±»å‹æ¨å¯¼ï¼ˆä¸å…¶å®ç°æœ‰å…³ï¼Œæ¯”å¦‚æ­¤æ—¶ lambda è¡¨è¾¾å¼ä¼šç”Ÿæˆä¸€ä¸ªé‡è½½è°ƒç”¨æ“ä½œç¬¦çš„åŒ¿åæ¨¡æ¿ç±»ï¼Œå› æ­¤ç”¨çš„æ˜¯æ¨¡æ¿ç±»å‹æ¨å¯¼ï¼‰</p>
<pre><code class="cpp">// auto åœ¨ C++14 ä¸­å¯ç”¨äºè¯´æ˜å‡½æ•°è¿”å›å€¼éœ€è¦æ¨å¯¼
auto create_list() &#123;
return &#123; 0x11, 0x45, 0x14 &#125;; // Compile errorï¼Œæ­¤æ—¶ä½¿ç”¨æ¨¡æ¿ç±»å‹æ¨å¯¼ï¼Œè€Œä¸æ˜¯ auto ç±»å‹æ¨å¯¼
&#125;

// auto åœ¨ C++14 ä¸­å¯ç”¨äºå½¢å‚æ¨å¯¼
std::vector&lt;int&gt; x;
auto reset_x = [&amp;x](const auto&amp; v) &#123; x = v; &#125;
reset_x(&#123; 0x11, 0x45, 0x14 &#125;); // Compile error
</code></pre>
<h3 id="decltype-ç±»å‹æ¨å¯¼"><a href="#decltype-ç±»å‹æ¨å¯¼" class="headerlink" title="decltype ç±»å‹æ¨å¯¼"></a><code>decltype</code> ç±»å‹æ¨å¯¼</h3><p><code>decltype</code> è¿›è¡Œçš„æ˜¯ä¸€ç§å¾ˆæ–°çš„ç±»å‹æ¨å¯¼ â€”â€” ä¸æ¨å¯¼ï¼Œæ˜¯çš„ï¼Œåªæ˜¯åŸæ±åŸå‘³åœ°è¿”å›å˜é‡çš„ç±»å‹ã€‚</p>
<p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœ <code>decltype</code> åº”ç”¨äºä¸€ä¸ªå˜é‡ <code>x</code> ï¼ˆç±»å‹ä¸º <code>T</code> ï¼‰çš„å¤æ‚å·¦å€¼è¡¨è¾¾å¼ï¼ˆå¤æ‚åªä¸æ­¢ç”± <code>x</code> æ„æˆï¼‰ï¼Œå°†è¿”å› <code>T&amp;</code> ï¼Œå¦åˆ™å°±è¿”å› <code>T</code> ï¼Œæ‰€ä»¥ä¼šå‡ºç°ä»¥ä¸‹è¿™ç§â€é‡å˜äº§ç”Ÿè´¨å˜â€œçš„ç°è±¡ï¼š</p>
<pre><code class="cpp">int x = 0;
decltype(x)   // -&gt; int
decltype((x)) // -&gt; int &amp;
</code></pre>
<p>ä¸‹é¢æ˜¯å…³äº <code>decltype</code> çš„ä¸€äº›ç±»å‹æ¨å¯¼ç»“æœï¼Œå¯ä»¥ä¸Š <a target="_blank" rel="noopener" href="https://godbolt.org/z/5EK4o94cs">godbolt</a> è‡ªå·±è¯•è¯•ï¼ˆåŒ…å«ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼‰ã€‚</p>
<pre><code class="cpp">class Clazz &#123;&#125;;

Clazz c1;               // c1 -&gt; Clazz
const Clazz &amp;c2 = c1;   // c2 -&gt; const Clazz &amp;
auto c3 = c2;           // c3 -&gt; Clazz
decltype(c2) c4 = c2;   // c4 -&gt; const Clazz &amp;
decltype(auto) c5 = c2; // c5 -&gt; const Clazz &amp;

// decltype(auto) å°±æ˜¯ decltype + auto ^_^
// å¥½å¤„æ˜¯è®© decltype ä¸å†ä¾èµ–å½¢å‚äº†ï¼Œå¾ˆå®ç”¨çš„ä¸€ä¸ªç‰¹æ€§
</code></pre>
<h3 id="ä¸€äº›æœ‰ç”¨çš„å·¥å…·"><a href="#ä¸€äº›æœ‰ç”¨çš„å·¥å…·" class="headerlink" title="ä¸€äº›æœ‰ç”¨çš„å·¥å…·"></a>ä¸€äº›æœ‰ç”¨çš„å·¥å…·</h3><p><strong>1. Boost.TypeIndex â†’</strong> æ‰“å°å˜é‡çš„å®Œæ•´ç±»å‹ï¼ˆ<a target="_blank" rel="noopener" href="https://godbolt.org/z/5EK4o94cs">godbolt</a>ï¼‰</p>
<pre><code class="cpp">#include &lt;boost/type_index.hpp&gt;

using boost::typeindex::type_id_with_cvr;

class Clazz &#123;&#125;;
Clazz c1;

cout &lt;&lt; &quot;c1 -&gt; &quot; &lt;&lt; type_id_with_cvr&lt;decltype(c1)&gt;().pretty_name() &lt;&lt; endl;
</code></pre>
<p><strong>2. <a target="_blank" rel="noopener" href="https://www.notion.so/C-11-14-546b3e79ca114dc79ced235d4f85f1eb">cdecl.org</a> â†’ ç”¨è‡ªç„¶è¯­è¨€è§£é‡Šå˜é‡ç±»å‹</strong></p>
<p>æ‰€ä»¥å‰é¢çªå‡»æ£€æŸ¥çš„é—®é¢˜ï¼Œç­”æ¡ˆåœ¨<a target="_blank" rel="noopener" href="https://cdecl.org/?q=char+const+*(*(*+const+bar)%5B5%5D)+(int)">è¿™é‡Œ</a>ï¼ˆä½ åšå¯¹äº†å— ğŸ¤£ï¼‰</p>
<h2 id="å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰ä¸å®Œç¾è½¬å‘"><a href="#å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰ä¸å®Œç¾è½¬å‘" class="headerlink" title="å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰ä¸å®Œç¾è½¬å‘"></a>å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰ä¸å®Œç¾è½¬å‘</h2><blockquote>
<p><code>template&lt;typename T&gt; void f(std::vector&lt;T&gt; &amp;&amp; param);</code> ä¸­çš„ <code>&amp;&amp;</code> æ˜¯ä¸‡èƒ½å¼•ç”¨å—ï¼Ÿ</p>
</blockquote>
<h3 id="amp-amp-å³å€¼å¼•ç”¨ä¸ä¸‡èƒ½å¼•ç”¨"><a href="#amp-amp-å³å€¼å¼•ç”¨ä¸ä¸‡èƒ½å¼•ç”¨" class="headerlink" title="&amp;&amp; : å³å€¼å¼•ç”¨ä¸ä¸‡èƒ½å¼•ç”¨"></a><code>&amp;&amp;</code> : å³å€¼å¼•ç”¨ä¸ä¸‡èƒ½å¼•ç”¨</h3><ul>
<li><p>åœ¨ C++11 ä¸­ï¼Œ <code>&amp;&amp;</code> æ—¢å¯ä»¥è¡¨ç¤ºå³å€¼å¼•ç”¨ï¼Œåˆèƒ½è¡¨ç¤ºä¸‡èƒ½å¼•ç”¨ï¼ˆå¦‚æœä½ è¿˜ä¸å¤ªæ¸…æ¥šä»€ä¹ˆæ˜¯å·¦å€¼/å³å€¼/çº¯å³å€¼ï¼Œä»€ä¹ˆæ˜¯å³å€¼å¼•ç”¨/ä¸‡èƒ½å¼•ç”¨ï¼Œå¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://paul.pub/cpp-value-category/">è¿™ç¯‡æ–‡ç« </a> ^_^ï¼‰</p>
</li>
<li><p>å³å€¼å¼•ç”¨ç”¨äºå»¶é•¿ä¸´æ—¶ï¼ˆå°†äº¡ï¼‰å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¸¸ç”¨äºç§»åŠ¨æ„é€ ã€ç§»åŠ¨èµ‹å€¼ç­‰åœºæ™¯ï¼Œé¿å…å†—ä½™å¤åˆ¶æ“ä½œå¸¦æ¥çš„æ€§èƒ½æŸè€—</p>
</li>
<li><p>å€¼å¾—ç›Šäº <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/copy_elision">RVO</a>ï¼ˆè¿”å›å€¼ä¼˜åŒ–ï¼‰ï¼Œå¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬æ²¡æœ‰å¿…è¦ä½¿ç”¨å³å€¼å¼•ç”¨æ¥ä¼˜åŒ–ä»£ç ï¼Œæ¯”å¦‚ä»¥ä¸‹ä¾‹å­ä¸­ï¼Œ <code>GetClazz</code> å‡½æ•°å°†åœ¨è¿”å›çš„åœ°å€ä¸Šç›´æ¥åˆå§‹åŒ–ï¼Œæ‰€ä»¥å¯¹å±€éƒ¨å˜é‡ <code>c</code> ä½¿ç”¨ move æ˜¯å¤šä½™çš„ï¼Œè¿˜ä¼šäº§ç”Ÿä¸€æ¬¡ç§»åŠ¨çš„å¤šä½™å¼€é”€</p>
<pre><code class="cpp">struct Clazz &#123;&#125;;
Clazz GetClazz() &#123;
  Clazz c;
  return std::move(c); // Bad
  return c;            // Good, RVO
&#125;
int main() &#123;
  Clazz &amp;&amp;c1 = GetClazz(); // Not necessary
  Clazz c2 = GetClazz();   // Good
&#125;
</code></pre>
</li>
<li><p><code>&amp;&amp;</code> è¡¨ç¤ºä¸‡èƒ½å¼•ç”¨çš„æ¡ä»¶ï¼šå…·å¤‡ <code>T&amp;&amp;</code> å½¢å¼ï¼Œä¸”éœ€è¦ç»è¿‡æ¨å¯¼æ‰èƒ½ç¡®å®šæœ€ç»ˆå¼•ç”¨ç±»å‹</p>
<pre><code class="cpp">template&lt;typename T&gt;
void f(T &amp;&amp;param); // ä¸‡èƒ½å¼•ç”¨

template&lt;typename T&gt;
void f(std::vector&lt;T&gt; &amp;&amp; param); // å¹¶é T æœ¬èº«éœ€è¦æ¨å¯¼ï¼Œå› ä¸º &amp;&amp; è¡¨ç¤ºå³å€¼å¼•ç”¨

Clazz &amp;&amp;c1 = Clazz(); // å³å€¼å¼•ç”¨
auto &amp;&amp;c2 = c1;       // ä¸‡èƒ½å¼•ç”¨
</code></pre>
</li>
<li><p>å¼•ç”¨æŠ˜å </p>
<ul>
<li>å·¦å€¼å¼•ç”¨çŸ­è·¯å³å€¼å¼•ç”¨</li>
</ul>
<pre><code class="cpp">// https://en.cppreference.com/w/cpp/language/reference#Reference_collapsing
typedef int&amp;  lref;
typedef int&amp;&amp; rref;
int n;

lref&amp;  r1 = n; // type of r1 is int&amp;
lref&amp;&amp; r2 = n; // type of r2 is int&amp;
rref&amp;  r3 = n; // type of r3 is int&amp;
rref&amp;&amp; r4 = 1; // type of r4 is int&amp;&amp;
</code></pre>
<ul>
<li>å¼•ç”¨æŠ˜å å‘ç”Ÿçš„å››ç§åœºæ™¯<ul>
<li>æ¨¡æ¿å®ä¾‹åŒ–</li>
<li><code>auto</code> å˜é‡çš„ç±»å‹æ¨å¯¼</li>
<li>ç”Ÿæˆå’Œä½¿ç”¨ <code>typedef</code> / <code>using</code> å£°æ˜</li>
<li><code>decltype</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="std-move-ä¸-std-forward"><a href="#std-move-ä¸-std-forward" class="headerlink" title="std::move ä¸ std::forward"></a><code>std::move</code> ä¸ <code>std::forward</code></h3><p><code>std::move</code> ä¸è¿›è¡Œä»»ä½•ç§»åŠ¨ï¼Œ <code>std::forward</code> ä¹Ÿä¸è¿›è¡Œä»»ä½•è½¬å‘ï¼Œä¸¤è€…åœ¨è¿è¡ŒæœŸéƒ½ä¸å‘æŒ¥ä½œç”¨ï¼Œåªæ˜¯è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä»¥ä¸‹æ˜¯ä¸¤è€…çš„ç®€å•å®ç°ã€‚</p>
<pre><code class="cpp">// std::move
template&lt;typename T&gt;
remove_reference_t&lt;T&gt;&amp;&amp; move(T &amp;&amp;t) &#123;
  return static_cast&lt;remove_reference_t&lt;T&gt;&amp;&amp;&gt;(t);
&#125;

// std::forward
template&lt;typename T&gt;
T&amp;&amp; forward&lt;remove_reference_t&lt;T&gt; &amp;t) &#123;
  return static_cast&lt;T&amp;&amp;&gt;(t);
&#125;

template&lt;typename T&gt;
T&amp;&amp; forward&lt;remove_reference_t&lt;T&gt; &amp;&amp;t) &#123;
  return static_cast&lt;T&amp;&amp;&gt;(t);
&#125;
</code></pre>
<p>å®Œç¾è½¬å‘å¤±æ•ˆçš„åœºæ™¯</p>
<ul>
<li><p>å¤§æ‹¬å·åˆå§‹åŒ–<br>ç”±äºå½¢å‚æœªå£°æ˜ä¸º <code>std::initializer_list</code> ï¼Œç¼–è¯‘å™¨ä¼šè¢«ç¦æ­¢åœ¨ <code>fwd</code> çš„è°ƒç”¨è¿‡ç¨‹ä¸­ä»è¡¨è¾¾å¼ <code>&#123;1, 2, 3&#125;</code> å‡ºå‘æ¥æ¨å¯¼ç±»å‹ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨æ‹’ç»è¿™ä¸ªè°ƒç”¨</p>
<pre><code class="cpp">// https://godbolt.org/z/d45Wr54Ya
void f(const std::vector&lt;int&gt; &amp;v) &#123;&#125;
template&lt;typename T&gt;
void fwd(T &amp;&amp;param) &#123;
  f(std::forward&lt;T&gt;(param));
&#125;

template&lt;typename... Ts&gt;
void fwd(Ts&amp;&amp;... params) &#123;
  f(std::forward&lt;Ts&gt;(params)...);
&#125;

int main() &#123;
    fwd(&#123;1, 2, 3&#125;); // Compile error
    // note: candidate template ignored: couldn&#39;t infer template argument &#39;T&#39;
    // note: candidate template ignored: substitution failure:
    //   deduced incomplete pack &lt;(no value)&gt; for template parameter &#39;Ts&#39;
    auto list = &#123;1, 2, 3&#125;; // list -&gt; std::initializer_list
    fwd(list); // OK
&#125;
</code></pre>
</li>
<li><p>ä»…æœ‰å£°æ˜çš„æ•´å‹ static const æˆå‘˜å˜é‡<br>ç¼–è¯‘å™¨ä¼šå¯¹ç±»ä¸­çš„æ•´å‹ static const æˆå‘˜å˜é‡åšä¼˜åŒ–ï¼Œå°†å…¶ç¼–è¯‘æˆç¼–è¯‘æœŸå¸¸é‡ï¼Œè¿›è€Œé¿å…ä¸ºè¿™äº›æˆå‘˜å˜é‡åˆ†é…å†…å­˜ï¼›åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹è¿™äº›æˆå‘˜å˜é‡å®æ–½å–å€æ“ä½œå°±ä¼šäº§ç”Ÿé“¾æ¥æœŸé—´å¤±è´¥ï¼Œè§£å†³åŠæ³•æ˜¯ç»™ <code>Clazz::kConstMember</code> æä¾›æ˜¾å¼å®šä¹‰ï¼ˆåªéœ€è¦åœ¨ç±»å£°æ˜å¤–è¾¹æä¾›å®šä¹‰å³å¯ï¼š <code>const std::size_t Clazz::kConstMember;</code> ï¼‰</p>
<pre><code class="cpp">// https://godbolt.org/z/3bqoeWsT6
class Clazz &#123;
 public:
  static const std::size_t kConstMember = 0x114514;
&#125;;

std::vector&lt;int&gt; data;
data.reserve(Clazz::kConstMember); // æ— æ³•å–å€¼

// åŒæ ·åœ°ï¼Œå°† Clazz::kConstMember ä¼ å…¥ fwdï¼Œä¹Ÿä¼šå› ä¸ºæ— æ³•å–å€è€Œäº§ç”Ÿé“¾æ¥æœŸå¤±è´¥
fwd(Clazz::kConstMember); // undefined reference to `Clazz::kConstMember&#39;
</code></pre>
</li>
<li><p>é‡è½½çš„å‡½æ•°åç§°å’Œæ¨¡æ¿åç§°<br>å‡½æ•°æ¨¡æ¿æ²¡æœ‰å…³äºç±»å‹éœ€æ±‚çš„ä¿¡æ¯ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸èƒ½å†³è®®éœ€è¦ä¼ é€’å“ªä¸ªå‡½æ•°çš„é‡è½½ç‰ˆæœ¬ï¼ˆè·Ÿåœºæ™¯ä¸€æœ‰ç‚¹ç›¸ä¼¼ï¼‰</p>
<pre><code class="cpp">void f(int (*pf)(int));
void f(int pf(int));

int process_val(int value);
int process_val(int value, int priority);

f(process_val); // OK
fwd(process_val); // Compiler error
</code></pre>
</li>
<li><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/bit_field">ä½åŸŸ</a><br>ç”±äºä½åŸŸä¸èƒ½å¯¹å…¶ç›´æ¥å–å€¼ï¼Œè€Œå‡½æ•°æ¨¡æ¿çš„å½¢å‚æ˜¯ä¸ªå¼•ç”¨ï¼Œå› æ­¤ä½åŸŸä¸èƒ½ä½œä¸ºå…¶å®å‚ï¼ˆä½†å¯ä»¥å…ˆå°†ä½åŸŸè½¬æ¢ä¸ºå…¶ä»–ç±»å‹å†è°ƒç”¨å‡½æ•°æ¨¡æ¿ï¼‰</p>
</li>
</ul>
<h2 id="æ™ºèƒ½æŒ‡é’ˆ"><a href="#æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="æ™ºèƒ½æŒ‡é’ˆ"></a>æ™ºèƒ½æŒ‡é’ˆ</h2><p>æ™ºèƒ½æŒ‡é’ˆæ˜¯ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/raii">RAII</a> (Resource Aequisition Is Initialization) åœ¨å†…å­˜èµ„æºç®¡ç†ä¸Šçš„ä½“ç°ï¼Œç›¸æ¯”è£¸æŒ‡é’ˆéœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„è·å–å’Œé‡Šæ”¾ï¼Œæ›´åŠ å®‰å…¨å’Œæ˜“ç”¨ã€‚</p>
<h3 id="auto-ptr"><a href="#auto-ptr" class="headerlink" title="auto_ptr"></a><code>auto_ptr</code></h3><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/memory/auto_ptr"><code>auto_ptr</code></a> æ˜¯ C++98 æ®‹ç•™ä¸‹æ¥çš„å¼ƒç”¨ç‰¹æ€§ï¼Œæ˜¯å¯¹æ™ºèƒ½æŒ‡é’ˆè¿›è¡Œæ ‡å‡†åŒ–çš„å°è¯•ï¼Œç”±äºå†å²åŸå› ï¼Œ <code>auto_ptr</code> ä½¿ç”¨å¤åˆ¶æ“ä½œæ¥ç§»åŠ¨å¯¹è±¡ï¼Œå¯¼è‡´äº†ä¸€äº›è¯­ä¹‰ä¸Šçš„ç¼ºé™·ï¼ˆæ¯”å¦‚å¯¹ <code>auto_ptr</code> æ‰§è¡Œå¤åˆ¶æ“ä½œä¼šå°†å…¶å€¼ç½®ç©ºï¼‰ï¼Œåæ¥è¢« <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/memory/unique_ptr"><code>unique_ptr</code></a> ä»£æ›¿ã€‚</p>
<h3 id="unique-ptr"><a href="#unique-ptr" class="headerlink" title="unique_ptr"></a><code>unique_ptr</code></h3><ul>
<li><p><code>unique_ptr</code> ç›¸æ¯”è£¸æŒ‡é’ˆåœ¨é»˜è®¤æƒ…å†µä¸‹å¤§å°ç›¸åŒï¼Œæ€§èƒ½ç›¸æ¯” <code>shared_ptr</code> æ›´å¥½ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘é€‰æ‹© <code>unique_ptr</code> æ¥ç®¡ç†å†…å­˜</p>
</li>
<li><p><code>unique_ptr</code> æ˜¯å…¸å‹çš„åªå¯ç§»åŠ¨çš„å¯¹è±¡ï¼Œç§»åŠ¨ä¸€ä¸ª <code>unique_ptr</code> å°†ä¼šå‘ç”Ÿå†…å­˜æ‰€æœ‰æƒï¼ˆå®é™…ä¸Šå°±æ˜¯å…¶æŒæœ‰çš„è£¸æŒ‡é’ˆï¼‰çš„è½¬ç§»</p>
</li>
<li><p><code>unique_ptr</code> çš„ä¸€ä¸ªå¸¸è§ç”¨æ³•æ˜¯ä½œä¸ºå·¥å‚å‡½æ•°çš„è¿”å›ç±»å‹</p>
<pre><code class="cpp">class Animal &#123;&#125;;
class Dog : public Animal &#123;&#125;;
class Cat : public Animal &#123;&#125;;
class Pig : public Animal &#123;&#125;;

unique_ptr&lt;Animal&gt; produce_animal(...) &#123;
  if (...) &#123;
    return make_unique&lt;Dog&gt;(...);
  &#125;
  if (...) &#123;
    return make_unique&lt;Cat&gt;(...);
  &#125;
  // ...
&#125;
</code></pre>
</li>
<li><p><code>unique_ptr</code> å…±åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼Œ <code>unique_ptr&lt;T&gt;</code> å’Œ <code>unique_ptr&lt;T[]&gt;</code> ï¼›å‰è€…ä¸æä¾›ç´¢å¼•è¿ç®—ç¬¦ <code>[]</code> ï¼Œåè€…ä¸æä¾› <code>*</code> å’Œ <code>-&gt;</code></p>
</li>
<li><p><code>unique_ptr</code> è¿˜å¯ä»¥ä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„ææ„å™¨ <code>unique_ptr&lt;class T, class Deleter&gt;</code> ï¼Œä½†ä¸€èˆ¬ä¸éœ€è¦ç”¨åˆ°ï¼ˆä¼ å…¥è‡ªå®šä¹‰ææ„å™¨ä¹‹åï¼Œ <code>unique_ptr</code> ç±»çš„å¤§å°å°±éœ€è¦åŠ ä¸Šè‡ªå®šä¹‰ææ„å™¨çš„å¤§å°äº†</p>
</li>
<li><p><code>unique_ptr</code> çš„ä¸€ä¸ªç®€å•å®ç°</p>
<pre><code class="cpp">template&lt;typename T&gt;
class my_unique_ptr &#123;
 public:
  my_unique_ptr() : ptr(nullptr) &#123;&#125;
  my_unique_ptr(T *ptr) : ptr(ptr) &#123;&#125;
  ~my_unique_ptr() &#123;
    __cleanup__();
  &#125;

  // copying is not permitted
  my_unique_ptr(const my_unique_ptr &amp;ptr) = delete;
  my_unique_ptr &amp;operator=(const my_unique_ptr &amp;ptr) = delete;

  my_unique_ptr(my_unique_ptr &amp;&amp;another) &#123;
    ptr = another.ptr;
    another.ptr = nullptr;
  &#125;
  my_unique_ptr &amp;operator=(my_unique_ptr &amp;&amp;another) &#123;
    __cleanup__();
    ptr = another.ptr;
    another.ptr = nullptr;
  &#125;

  // dereferencing
  T *operator-&gt;() const &#123;
    return ptr;
  &#125;

  // dereferencing
  T &amp;operator*() const &#123;
    return *ptr;
  &#125;

 private:
  void __cleanup__() &#123;
    if (ptr != nullptr) &#123;
      delete ptr;
    &#125;
  &#125;

  T *ptr;
&#125;;
</code></pre>
</li>
</ul>
<h3 id="shared-ptr"><a href="#shared-ptr" class="headerlink" title="shared_ptr"></a><code>shared_ptr</code></h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/memory/shared_ptr"><code>shared_ptr</code></a> ç”¨äºå¤šä¸ªæŒ‡é’ˆéœ€è¦å…±åŒç®¡ç†ä¸€ä¸ªå†…å­˜å¯¹è±¡çš„æƒ…å½¢ï¼ˆä½¿ç”¨çš„æ—¶å€™ï¼Œè€ƒè™‘ä¸€ä¸‹è‡ªå·±æ˜¯å¦çœŸçš„å¤„äºè¿™ç§æƒ…å†µï¼‰</p>
</li>
<li><p><code>shared_ptr</code> çš„åŸç†æ˜¯å¼•ç”¨è®¡æ•° + å…±äº«å†…å­˜</p>
</li>
<li><p>é™¤äº†æŒæœ‰è£¸æŒ‡é’ˆå¤–ï¼Œè¿˜é€šè¿‡ä¸€ä¸ªæ§åˆ¶å—æ¥ç®¡ç†å¼•ç”¨è®¡æ•°ç­‰ä¿¡æ¯ï¼ˆè¿˜æœ‰å¼±è®¡æ•°ã€è‡ªå®šä¹‰ Deleter ç­‰ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹çŸ¥é“æœ‰ä¸ªå¼•ç”¨è®¡æ•°ä¹Ÿå°±å¤Ÿå•¦ï¼‰</p>
</li>
<li><p>æŒ‡æ¶‰åˆ°åŒä¸€å†…å­˜å¯¹è±¡çš„ <code>shared_ptr</code> å…±äº«æ§åˆ¶å—ä¿¡æ¯ï¼›å› æ­¤ï¼Œ<strong>å¼•ç”¨è®¡æ•°çš„é€’å¢å’Œé€’å‡å¿…é¡»æ˜¯åŸå­æ“ä½œ</strong></p>
</li>
<li><p>å½“æœ€åä¸€ä¸ªæŒæœ‰æŸå¯¹è±¡çš„ <code>shared_ptr</code> ä¸å†æŒæœ‰å®ƒæ—¶ï¼ˆå¼•ç”¨è®¡æ•°ä¸º 0ï¼Œä¾‹å¦‚ <code>shared_ptr</code> è¢«ææ„ã€æˆ– reset ä¸ºå¦ä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œ <code>shared_ptr</code> ä¼šææ„è¯¥å¯¹è±¡</p>
</li>
<li><p><code>shared_ptr</code> ä¹Ÿæ”¯æŒæŒ‡å®šè‡ªå®šä¹‰ææ„å™¨ï¼Œä½†å¹¶ä¸ä½œä¸º <code>shared_ptr</code> ç±»å‹çš„ä¸€éƒ¨åˆ† <code>shared_ptr&lt;Clazz&gt; sp(new Clazz, custom_deleter);</code> ï¼ˆè¿™ä¸€ç‚¹ä¸ <code>unique_ptr</code> ä¸å¤ªä¸€æ ·ï¼‰</p>
</li>
<li><p>ä»¥ä¸‹æƒ…å†µæ„é€  <code>shared_ptr</code> ä¼šåˆ›å»ºä¸€ä¸ªæ§åˆ¶å—</p>
</li>
<li><p>è°ƒç”¨ <code>make_shared</code> æ—¶</p>
</li>
<li><p>ä» <code>unique_ptr</code> / <code>auto_ptr</code> / è£¸æŒ‡é’ˆå‡ºå‘æ„é€ ä¸€ä¸ª <code>shared_ptr</code> æ—¶</p>
</li>
<li><p>é¿å…ä»åŒä¸€ä¸ªè£¸æŒ‡é’ˆå‡ºå‘æ„é€ å¤šä¸ª <code>shared_ptr</code></p>
</li>
<li><p><code>shared_ptr</code> çš„ä¸€ä¸ªç®€å•å®ç°</p>
</li>
</ul>
<pre><code class="cpp">typedef unsigned int uint;
template&lt;typename T&gt;
class my_shared_ptr &#123;
 public:
  my_shared_ptr() : ptr(nullptr), ref_count(new uint(0)) &#123;&#125;
  my_shared_ptr(T *ptr) : ptr(ptr), ref_count(new uint(1)) &#123;&#125;
  ~my_shared_ptr() &#123;
    __cleanup__();
  &#125;

  my_shared_ptr(const my_shared_ptr &amp;another) &#123;
    ptr = another.ptr;
    ref_count = another.ref_count;
    if (another.ptr != nullptr) &#123;
      (*ref_count)++;
    &#125;
  &#125;
  my_shared_ptr &amp;operator=(const my_shared_ptr &amp;another) &#123;
    __cleanup__();
    ptr = another.ptr;
    ref_count = another.ref_count;
    if (another.ptr != nullptr) &#123;
      (*ref_count)++;
    &#125;
  &#125;

  my_shared_ptr(my_shared_ptr &amp;&amp;another) &#123;
    ptr = another.ptr;
    ref_count = another.ref_count;
    another.ref_count = nullptr;
    another.ptr = nullptr;
  &#125;
  my_shared_ptr &amp;operator=(my_shared_ptr &amp;&amp;another) &#123;
    __cleanup__();
    ptr = another.ptr;
    ref_count = another.ref_count;
    another.ref_count = nullptr;
    another.ptr = nullptr;
  &#125;

  T *operator-&gt;() const &#123;
    return ptr;
  &#125;

  T &amp;operator*() const &#123;
    return *ptr;
  &#125;

  uint get_count() const &#123;
    return *ref_count;
  &#125;

  T *get() const &#123;
    return ptr;
  &#125;

 private:
  void __cleanup__() &#123;
    (*ref_count)--;
    if (*ref_count == 0) &#123;
      if (ptr != nullptr) &#123;
        delete ptr;
      &#125;
      delete ref_count;
    &#125;
  &#125;

  T *ptr = nullptr;

  // `ref_count` should be pointer pointing to heap memory,
  // to share reference count between different `shared_ptr` objects
  uint *ref_count = nullptr;
&#125;;
</code></pre>
<h3 id="weak-ptr"><a href="#weak-ptr" class="headerlink" title="weak_ptr"></a><code>weak_ptr</code></h3><ul>
<li><p>å¼•ç”¨è®¡æ•°çš„ç¼ºç‚¹æ˜¯ï¼Œå¯¹äºå¾ªç¯å¼•ç”¨ï¼Œéœ€è¦å¼•å…¥ä¸€ä¸ªç¬¬ä¸‰è€…æ¥ç ´å±€ï¼Œ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/memory/weak_ptr"><code>weak_ptr</code></a> å®ƒæ¥äº†</p>
</li>
<li><p><code>weak_ptr</code> ä¸€èˆ¬é€šè¿‡ <code>shared_ptr</code> åˆ›å»ºï¼Œä½†ä¸å½±å“æŒæœ‰è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼ˆä¸è¿‡ä¼šå½±å“å¼±å¼•ç”¨è®¡æ•°ï¼‰</p>
<pre><code class="cpp">// https://godbolt.org/z/9scTG96ss
auto sp = std::make_shared&lt;Clazz&gt;();  // ref_count = 1
std::weak_ptr&lt;Clazz&gt; wp(sp);          // ref_count = 1
sp = nullptr;  // ref_count = 0, `wp` is dangling
assert(wp.expired());  // pass
</code></pre>
</li>
<li><p><code>weak_ptr</code> æ²¡æœ‰å–å€æ“ä½œï¼Œå› æ­¤å¦‚æœéœ€è¦å–å‡ºå…¶æŒ‡å‘çš„å¯¹è±¡ï¼Œéœ€è¦å…ˆé€šè¿‡ <code>std::weak_ptr::lock</code> è½¬æ¢ä¸º <code>shared_ptr</code></p>
<pre><code class="cpp">std::shared_ptr&lt;Clazz&gt; sp1 = wp.lock(); // è‹¥ wp å¤±æ•ˆï¼Œåˆ™è¿”å›ç©º
std::shared_ptr&lt;Clazz&gt; sp2(wp); // è‹¥ wp å¤±æ•ˆï¼Œåˆ™æŠ›å‡º std::bad_weak_ptr å¼‚å¸¸
</code></pre>
</li>
<li><p><code>weak_ptr</code> ä¸€èˆ¬ç”¨äºåˆ¤æ–­ç¼“å­˜å¤±æ•ˆã€è§‚å¯Ÿè€…æ¨¡å¼ã€è§£é™¤å¾ªç¯å¼•ç”¨ç­‰åœºæ™¯</p>
</li>
</ul>
<h3 id="ä¼˜å…ˆä½¿ç”¨-make-unique-å’Œ-make-shared"><a href="#ä¼˜å…ˆä½¿ç”¨-make-unique-å’Œ-make-shared" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨ make_unique å’Œ make_shared"></a>ä¼˜å…ˆä½¿ç”¨ <code>make_unique</code> å’Œ <code>make_shared</code></h3><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/memory/shared_ptr/make_shared"><code>make_shared</code></a> åœ¨ C++11 å¼•å…¥æ ‡å‡†åº“ï¼Œä½† <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/memory/unique_ptr/make_unique"><code>make_unique</code></a> åœ¨ C++14 æ‰å¼•å…¥ã€‚</p>
<p>ä½¿ç”¨ <code>make_unique</code> / <code>make_shared</code> çš„ä¼˜åŠ¿</p>
<ul>
<li><p>æ€§èƒ½æ›´å¥½ï¼ˆç»å…¸çš„ä¸¤æ¬¡å†…å­˜åˆ†é…é—®é¢˜ï¼‰</p>
<pre><code class="cpp">std::shared_ptr&lt;Clazz&gt; sp1(new Clazz);
// ä¸¤æ¬¡å†…å­˜åˆ†é…
// 1. ä¸º Clazz è¿›è¡Œä¸€ä¸ªå†…å­˜åˆ†é…
// 2. ä¸º shared_ptr çš„æ§åˆ¶å—è¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…
auto sp2 = std::make_shared&lt;Clazz&gt;();
// ä¸€æ¬¡å†…å­˜åˆ†é…
// make_shared ä¼šåˆ†é…å•å—ï¼ˆsingle_chunckï¼‰å†…å­˜ï¼Œ
// æ—¢ä¿å­˜ Clazz å¯¹è±¡åˆä¿å­˜æ§åˆ¶å—å¯¹è±¡
</code></pre>
</li>
<li><p>å¯ä»¥é¿å…ä»£ç å¼‚å¸¸å¼•èµ·çš„å†…å­˜æ³„éœ²</p>
<pre><code class="cpp">process_object(std::shared_ptr&lt;Clazz&gt;(new Clazz), do_stuff_in_danger());
// è€ƒè™‘ä»¥ä¸‹çš„äº‹ä»¶å‘ç”Ÿé¡ºåº
// 1. new Clazz, åœ¨å †ä¸Šåˆ›å»º Clazz å¯¹è±¡
// 2. æ‰§è¡Œ do_stuff_in_danger
// 3. æ‰§è¡Œ std::shared_ptr æ„é€ å‡½æ•°
// å…¶ä¸­ï¼Œdo_stuff_in_danger å¯èƒ½åœ¨è¿è¡ŒæœŸäº§ç”Ÿå¼‚å¸¸ï¼Œè¿™æ—¶å€™å°±ä¼šé€ æˆ
// ç¬¬ä¸€æ­¥åŠ¨æ€åˆ†é…çš„ Clazz å†…å­˜æ³„éœ²
</code></pre>
</li>
<li><p>ä½¿ç”¨ make ç³»åˆ—å‡½æ•°å¯ä»¥è®©ä»£ç æ›´ç®€æ´</p>
<pre><code class="cpp">auto up1(std::make_unique&lt;Clazz&gt;());   // Good
std::unique_ptr&lt;Clazz&gt; up2(new Clazz); // éœ€è¦å†™ä¸¤æ¬¡ Clazz ç±»å‹
</code></pre>
</li>
</ul>
<p>ä½¿ç”¨ <code>make_unique</code> / <code>make_shared</code> çš„åŠ£åŠ¿</p>
<ul>
<li><p>ä¸æ”¯æŒè‡ªå®šä¹‰ææ„å™¨</p>
</li>
<li><p>make ç³»åˆ—å‡½æ•°å¯¹å½¢å‚è¿›è¡Œå®Œç¾è½¬å‘çš„ä»£ç ä½¿ç”¨çš„æ˜¯å°æ‹¬å·åˆå§‹åŒ–ï¼Œå› æ­¤åœ¨ä½¿ç”¨ initializer_list åˆå§‹åŒ–çš„åœºæ™¯å¯èƒ½ä¸è¡Œ</p>
</li>
<li><p><code>make_shared</code> åˆ›å»ºçš„å•å—å†…å­˜æŠŠæŒ‡å‘çš„å†…å­˜å¯¹è±¡å’Œæ§åˆ¶å—ç»‘å®šèµ·æ¥äº†ï¼Œå› æ­¤å¦‚æœè¿˜æœ‰ <code>weak_ptr</code> æŒ‡å‘è¯¥å¯¹è±¡ï¼Œç”±äºæ§åˆ¶å—è¿˜éœ€è¦å­˜åœ¨ï¼Œå› æ­¤æŒ‡å‘çš„å¯¹è±¡å†…å­˜æ­¤æ—¶ä¹Ÿæ²¡æ³•é‡Šæ”¾äº†</p>
</li>
</ul>
<h2 id="Lambda-è¡¨è¾¾å¼"><a href="#Lambda-è¡¨è¾¾å¼" class="headerlink" title="Lambda è¡¨è¾¾å¼"></a>Lambda è¡¨è¾¾å¼</h2><pre><code class="cpp">// https://godbolt.org/z/KE1a9M9Yx
auto a = []()&#123;&#125;;
auto b = []()&#123;&#125;;
// a å’Œ b æ˜¯åŒä¸ªç±»å‹å—ï¼Ÿ

function&lt;void()&gt; x = a;
function&lt;void()&gt; y = b;
// x å’Œ y æ˜¯åŒä¸ªç±»å‹å—ï¼Ÿ
</code></pre>
<p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/lambda">Lambda è¡¨è¾¾å¼</a>æ˜¯ C++11 å¼•å…¥çš„ç”¨äºæ„é€ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">é—­åŒ…</a>å¯¹è±¡ï¼ˆå³èƒ½å¤Ÿæ•è·ä¸Šä¸‹æ–‡ä¸­å˜é‡çš„åŒ¿åå‡½æ•°å¯¹è±¡ï¼‰çš„æ–¹æ³•ï¼Œå¸¸ç”¨äº <code>std::find_if</code> ç­‰éœ€è¦ä¼ å…¥ç‰¹å®šæ¯”è¾ƒå™¨çš„åœºæ™¯ã€‚</p>
<h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p>Lambda è¡¨è¾¾å¼çš„åŸºæœ¬å®ç°åŸç†æ˜¯å¯è°ƒç”¨åŒ¿åç±»ï¼ˆæ‰€ä»¥å‰é¢é—®é¢˜çš„ç­”æ¡ˆå°±ä¸è¨€è‡ªæ˜äº†ï¼‰ï¼Œä»¥ä¸‹å†™äº†ä¸€ä¸ªç®€å•çš„æ”¯æŒ auto å½¢å‚ï¼ˆC++14 å¼€å§‹æ”¯æŒï¼‰çš„ Lambda å®ç°ã€‚</p>
<pre><code class="cpp">// https://godbolt.org/z/EMKMPcTTf

class Lambda_0x8023 &#123;
 public:
  Lambda_0x8023(int a, string &amp;b): capture_a_(a), capture_b_(b)&#123;&#125;

  // Lambda è¡¨è¾¾å¼çš„è°ƒç”¨æ“ä½œç¬¦æ˜¯ const å‡½æ•°ï¼Œä¸èƒ½ä¿®æ”¹å€¼æ•è·çš„å¯¹è±¡
  // C++14 å constexpr æˆå‘˜å‡½æ•°æœ¬èº«æ˜¯ const æˆå‘˜å‡½æ•°ï¼Œä¸éœ€è¦åŠ  const
  template&lt;typename T&gt;
  constexpr auto operator()(T param) const &#123;
    // capture_a_ = 0x1; // Compile error
    capture_b_ = &quot;Modified test lambda: &quot;; // OK
    cout &lt;&lt; capture_b_ &lt;&lt; param &lt;&lt; endl;
  &#125;

 private:
  int capture_a_; // å€¼æ•è·
  string &amp;capture_b_; // å¼•ç”¨æ•è·
&#125;;

int main() &#123;
  int a = 0x0;
  string b = &quot;Test lambda: &quot;;
  // Lambda çš„ auto å‚æ•°é€šè¿‡åŒ¿åç±»çš„æ¨¡ç‰ˆæ–¹æ³•æ¥å®ç°
  auto lambda_1 = [a, &amp;b](auto x) &#123; cout &lt;&lt; b &lt;&lt; x &lt;&lt; endl; &#125;;
  lambda_1(0x114);
  lambda_1(&quot;C++ Lambda test&quot;);

  // å‡è£… Lambda_0x8023 æ˜¯ä»¥ä¸Š Lambda è¡¨è¾¾å¼ç”Ÿæˆçš„åŒ¿åç±»
  auto lambda_2 = Lambda_0x8023(a, b);
  lambda_2(0x514);
  lambda_2(&quot;Lambda simple implementation test&quot;);
&#125;
</code></pre>
<h3 id="å˜é‡æ•è·"><a href="#å˜é‡æ•è·" class="headerlink" title="å˜é‡æ•è·"></a>å˜é‡æ•è·</h3><ul>
<li><p>æŒ‰å¼•ç”¨æ•è·éœ€è¦æ³¨æ„æ‚¬å‚å¼•ç”¨ï¼ˆDangling referencesï¼‰ï¼Œä¸€æ—¦ Lambda åˆ›å»ºçš„é—­åŒ…è¶Šè¿‡äº†æŒ‰å¼•ç”¨æ•è·çš„å˜é‡çš„å£°æ˜å‘¨æœŸï¼Œå°±ä¼šå¯¼è‡´å¼•ç”¨ç©ºæ‚¬</p>
<pre><code class="cpp">// https://godbolt.org/z/3ej7f33Kb
void add_filter(vector&lt;function&lt;bool(int)&gt;&gt; &amp;filters) &#123;
  int benchmark = 0x114;
  filters.emplace_back([&amp;](int val) &#123;
    cout &lt;&lt; &quot;benchmark: &quot; &lt;&lt; benchmark &lt;&lt; endl;
    return val == benchmark;
  &#125;);
  // ç¦»å¼€å½“å‰å‡½æ•°åï¼Œæ ˆå˜é‡å°†è¢«å¼¹å‡ºï¼Œæ­¤æ—¶ &amp;benchmark å¤„çš„å€¼æœªå®šä¹‰
&#125;
int main() &#123;
  vector&lt;function&lt;bool(int)&gt;&gt; filters;
  add_filter(filters);
  auto f = filters[0];
  cout &lt;&lt; f(0x114) &lt;&lt; endl; // false
&#125;
</code></pre>
</li>
<li><p>æ•è·åªèƒ½é’ˆå¯¹åœ¨åˆ›å»º Lambda è¡¨è¾¾å¼çš„ä½œç”¨åŸŸå†…å¯è§çš„éé™æ€å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬å½¢å‚ï¼‰</p>
</li>
<li><p>C++14 å¼€å§‹æ”¯æŒå¹¿ä¹‰ Lambda æ•è·ï¼ˆæ”¯æŒåˆå§‹åŒ–æ•è·ï¼‰ï¼Œå°±å¯ä»¥å¼€å§‹ä½¿ç”¨ç§»åŠ¨æ„é€ æ•è·ä¹‹ç±»çš„ç‹ æ´»äº†ï¼ˆæ¯”å¦‚æŠŠ <code>unique_ptr</code> æ•è·è¿›æ¥ï¼‰<br><code>auto func = [pw = std::move(pw)] &#123; return pw-&gt;validated(); &#125;;</code> ï¼Œ</p>
</li>
</ul>
<h3 id="Lambda-vs-std-bind"><a href="#Lambda-vs-std-bind" class="headerlink" title="Lambda vs. std::bind"></a><code>Lambda</code> vs. <code>std::bind</code></h3><p>**ä¼˜å…ˆé€‰æ‹© Lambda è¡¨è¾¾å¼ï¼Œè€Œä¸æ˜¯ <code>std::bind</code> **</p>
<ul>
<li><p>Lambda è¡¨è¾¾å¼å¯è¯»æ€§æ›´å¥½</p>
</li>
<li><p>å…¥å‚ eval çš„æ—¶æœºæ›´æ˜ç¡®</p>
</li>
<li><p>æ”¯æŒå‡½æ•°é‡è½½</p>
</li>
<li><p>å¯¹å‡½æ•°å†…è”æ›´å‹å¥½ï¼ˆ <code>std::bind</code> é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨ï¼Œç¼–è¯‘å™¨è¶‹å‘äºä¸å†…è”é€šè¿‡å‡½æ•°æŒ‡é’ˆå‘èµ·çš„å‡½æ•°è°ƒç”¨ï¼‰</p>
</li>
<li><p><code>std::bind</code> å‡½æ•°å‚æ•°ä¼ é€’ç±»å‹ä¸æ˜æ˜¾</p>
</li>
<li><p>å¯¹äºâ€æ•è·â€œçš„å˜é‡ï¼Œ <code>std::bind</code> é»˜è®¤æ˜¯æŒ‰å€¼å­˜å‚¨çš„ï¼Œå¦‚æœéœ€è¦æŒ‰å¼•ç”¨å­˜å‚¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨ <code>std::ref()</code> å‡½æ•°</p>
</li>
<li><p><code>std::bind</code> è¿”å›çš„ç»“æœå¯¹è±¡ï¼Œå½¢å‚ï¼ˆplaceholdersï¼‰æ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’çš„</p>
</li>
</ul>
<pre><code class="cpp">using namespace std::chrono;
using namespace std::literals;
using Time = steady_clock::time_point;
using Duration = steady_clock::duration;
enum class Sound &#123; Beep, Siren, Whistle &#125;;

void set_alarm(Time t, Sound s, Duration d);

// å‡è®¾æˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªå‡½æ•°ï¼Œå®ç°åœ¨ä¸€å°æ—¶ä¹‹åå‘å‡ºè­¦æŠ¥ï¼Œå¹¶æŒç»­ 30s

// ä½¿ç”¨ Lambda å®ç°ï¼Œèƒ½å¤Ÿçªå‡ºæˆ‘ä»¬è°ƒç”¨ set_alarm å®ç°æ­¤åŠŸèƒ½
auto set_sound_lambda = [](Sound s) &#123;
  set_alarm(steady_clock::now() + 1h, s, 30s);
&#125;

// ä½¿ç”¨ std::bind å®ç°
auto set_sound_bind_wrong = std::bind(
  set_alarm,
  steady_clock::now() + 1h, // è¿™é‡Œå®é™…ä¸Šè¯­ä¹‰é”™äº†ï¼Œå› ä¸ºå®å‚ä¼šåœ¨ bind çš„æ—¶å€™ eval
  placeholders::_1,         // è€Œä¸æ˜¯åœ¨è°ƒç”¨æ—¶ eval
  30s
);

auto set_sound_bind_correct = std::bind(
  set_alarm,
  std::bind(std::plus&lt;steady_clock::time_point&gt;(), steady_clock::now(), 1h),
  placeholders::_1,
  30s
);

void set_alarm(Time t, Sound s, Duration d, Volume v);
// å‘ç”Ÿå‡½æ•°é‡è½½ï¼Œæ­¤æ—¶ std::bind çš„è°ƒç”¨æ— æ³•ç¼–è¯‘ï¼ˆbind æ‹¿åˆ°çš„ä¿¡æ¯åªæœ‰å‡½æ•°åç§°ï¼‰
</code></pre>
<p><a target="_blank" rel="noopener" href="https://abseil.io/tips/108">abseil æä¾›äº† <code>bind_front</code> å‡½æ•°</a>ï¼Œç›¸æ¯” <code>std::bind</code> åœ¨å¤šæ•°æƒ…å†µä¸‹æ›´æ˜“ç”¨ã€‚</p>
<h2 id="å®è·µæ‚è°ˆ"><a href="#å®è·µæ‚è°ˆ" class="headerlink" title="å®è·µæ‚è°ˆ"></a>å®è·µæ‚è°ˆ</h2><h3 id="åˆå§‹åŒ–æ–¹æ³•çš„é€‰æ‹©"><a href="#åˆå§‹åŒ–æ–¹æ³•çš„é€‰æ‹©" class="headerlink" title="åˆå§‹åŒ–æ–¹æ³•çš„é€‰æ‹©"></a>åˆå§‹åŒ–æ–¹æ³•çš„é€‰æ‹©</h3><p>C++ 11 å¼•å…¥äº†ç»Ÿä¸€åˆå§‹åŒ–ï¼ˆ <code>&#123;&#125;</code> åˆå§‹åŒ–ï¼‰ï¼Œè‡³æ­¤ï¼Œå„ç§åˆå§‹åŒ–æ–¹æ³•æ•´ä½“æ¯”è¾ƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img.picgo.net/2022/11/25/Untitledd5f4665c70d90197.png" alt="initialization.png"></p>
<p>ï¼ˆå›¾æº <a target="_blank" rel="noopener" href="http://josuttis.com/cpp/c++initialization.pdf">http://josuttis.com/cpp/c++initialization.pdf</a> ï¼‰</p>
<p>ç»Ÿä¸€åˆå§‹åŒ–çš„ä¼˜åŠ¿ä¸»è¦æœ‰ï¼š</p>
<ul>
<li><p>ç›¸æ¯”å…¶ä»–åˆå§‹åŒ–æ–¹å¼é€‚ç”¨èŒƒå›´æ›´å¹¿</p>
</li>
<li><p>å¤åˆ¶åˆå§‹åŒ–ä¸èƒ½ç”¨äº <code>atomic</code> ç­‰ä¸å¯å¤åˆ¶çš„å¯¹è±¡</p>
</li>
<li><p><code>()</code> åˆå§‹åŒ–æœ‰æ—¶å€™ä¼šä¸å¯ç”¨ï¼Œä¾‹å¦‚ <code>Clazz c();</code> å£°æ˜çš„æ˜¯å‡½æ•° <code>Clazz ()</code> è€Œä¸æ˜¯ <code>Clazz</code> å˜é‡</p>
</li>
<li><p>ç¦æ­¢ built-in ç±»å‹ä¹‹é—´è¿›è¡Œ narrowing conversionï¼Œè¿˜æ˜¯èƒ½é¿å…ä¸€äº›éšè—çš„ç±»å‹è½¬æ¢é—®é¢˜çš„</p>
</li>
</ul>
<p>ä¸è¿‡ï¼Œå½“ç»Ÿä¸€åˆå§‹åŒ–é‡åˆ° <code>std::initializer_list</code> æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°½å¯èƒ½åŒ¹é…å½¢å‚ä¸º <code>std::initializer_list</code> çš„å‡½æ•°é‡è½½ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="cpp">std::vector&lt;int&gt; v1(10, 20); // åˆ›å»ºä¸€ä¸ªåŒ…å« 10 ä¸ªå…ƒç´ çš„ vectorï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ 20
std::vector&lt;int&gt; v2&#123;10, 20&#125;; // åˆ›å»ºä¸€ä¸ªåŒ…å« 2 ä¸ªå…ƒç´ çš„ vectorï¼Œåˆ†åˆ«ä¸º 10 å’Œ 20
</code></pre>
<p>è¿™é‡Œæ¯”è¾ƒæ¨è <a target="_blank" rel="noopener" href="https://abseil.io/tips/88">abseil å…³äºåˆå§‹åŒ–çš„å®è·µ</a>ï¼š</p>
<ul>
<li><p>å¯¹äºåˆå§‹åŒ–è¿‡ç¨‹ä»…æ¶‰åŠç®€å•çš„ç±»å‹å®šä¹‰æˆ–å¤åˆ¶çš„åœºæ™¯ï¼ˆä¾‹å¦‚å­—é¢é‡åˆå§‹åŒ–ã€å¤åˆ¶åˆå§‹åŒ–ç­‰ï¼‰ï¼Œä½¿ç”¨ <code>=</code> åˆå§‹åŒ–</p>
<pre><code class="cpp">int x = 2;
std::string foo = &quot;Hello World&quot;;
std::vector&lt;int&gt; v = &#123;1, 2, 3&#125;;
std::unique_ptr&lt;Matrix&gt; matrix = NewMatrix(rows, cols);
MyStruct x = &#123;true, 5.0&#125;;
MyProto copied_proto = original_proto;
</code></pre>
</li>
<li><p>å¯¹äºåˆå§‹åŒ–è¿‡ç¨‹æ¶‰åŠæ„é€ é€»è¾‘çš„åœºæ™¯ï¼Œä½¿ç”¨ <code>()</code> åˆå§‹åŒ–</p>
<pre><code class="cpp">Frobber frobber(size, &amp;bazzer_to_duplicate);
std::vector&lt;double&gt; fifty_pies(50, 3.14);
</code></pre>
</li>
<li><p>å½“ä»¥ä¸Šä¸¤ç§æ–¹æ³•æ— æ³•ç¼–è¯‘æ—¶ï¼Œæ‰ä½¿ç”¨ <code>&#123;&#125;</code> åˆå§‹åŒ–</p>
</li>
</ul>
<h3 id="ä¼˜å…ˆä½¿ç”¨-nullptr-ï¼Œè€Œä¸æ˜¯-0-æˆ–-NULL"><a href="#ä¼˜å…ˆä½¿ç”¨-nullptr-ï¼Œè€Œä¸æ˜¯-0-æˆ–-NULL" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨ nullptr ï¼Œè€Œä¸æ˜¯ 0 æˆ– NULL"></a>ä¼˜å…ˆä½¿ç”¨ <code>nullptr</code> ï¼Œè€Œä¸æ˜¯ 0 æˆ– <code>NULL</code></h3><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/nullptr"><code>nullptr</code></a> æ˜¯ C++11 å¼•å…¥çš„çº¯å³å€¼ï¼Œå…¶ç±»å‹ä¸º <code>nullptr_t</code> ï¼Œå¯ä»¥éšå¼è½¬æ¢ä¸ºä»»ä½•æŒ‡é’ˆç±»å‹ã€‚</p>
<p>å› æ­¤ï¼Œç›¸æ¯” 0 å’Œ <code>NULL</code> ï¼Œ <code>nullptr_t</code> å¯ä»¥é¿å…è°ƒç”¨åˆ°æ¥å—å…¶ä»–ç±»å‹å½¢å‚çš„å‡½æ•°é‡è½½ç‰ˆæœ¬ã€‚</p>
<pre><code class="cpp">void f(int);
void f(bool);
void f(void*);

f(0);       // è°ƒç”¨ f(int)
f(NULL);    // åœ¨å¤§éƒ¨åˆ†ç¼–è¯‘å™¨ä¸‹ç¼–è¯‘å¤±è´¥
f(nullptr); // è°ƒç”¨ f(void*)
</code></pre>
<h3 id="ä¼˜å…ˆä½¿ç”¨-using-ï¼Œè€Œä¸æ˜¯-typedef"><a href="#ä¼˜å…ˆä½¿ç”¨-using-ï¼Œè€Œä¸æ˜¯-typedef" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨ using ï¼Œè€Œä¸æ˜¯ typedef"></a>ä¼˜å…ˆä½¿ç”¨ <code>using</code> ï¼Œè€Œä¸æ˜¯ <code>typedef</code></h3><ol>
<li><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/type_alias"><code>using</code></a> å¯è¯»æ€§æ›´å¥½</li>
</ol>
<pre><code class="cpp">typedef void (*FP)(int, const std::string&amp;);
using FP = void (*)(int, const std::string&amp;);
</code></pre>
<ol start="2">
<li><code>using</code> æ”¯æŒæ¨¡æ¿åŒ–ï¼Œä½† <code>typedef</code> ä¸æ”¯æŒ</li>
</ol>
<pre><code class="cpp">template&lt;class T&gt;
struct Alloc &#123;&#125;;
template&lt;class T&gt;
using Vec = vector&lt;T, Alloc&lt;T&gt;&gt;; // type-id is vector&lt;T, Alloc&lt;T&gt;&gt;
Vec&lt;int&gt; v; // Vec&lt;int&gt; is the same as vector&lt;int, Alloc&lt;int&gt;&gt;
</code></pre>
<ol start="3">
<li> <code>using</code> æ¨¡æ¿å¯ä»¥é¿å… <code>::type</code> åç¼€ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦è€ƒè™‘æ¨¡æ¿å†…å¸¦ä¾èµ–ç±»å‹çš„ <code>typename</code> å‰ç¼€ï¼›C++14 æ­£æ˜¯åœ¨ type traits ä¸­å¼•å…¥äº† <code>using</code> ï¼Œä½¿å…¶è¯­æ³•å‹å¥½äº†å¾ˆå¤š</li>
</ol>
<pre><code class="cpp">std::remove_const&lt;T&gt;::type // C++11
std::remove_const_t&lt;T&gt;     // C++14
</code></pre>
<h3 id="ä¼˜å…ˆä½¿ç”¨-enum-class-ï¼Œè€Œä¸æ˜¯-enum"><a href="#ä¼˜å…ˆä½¿ç”¨-enum-class-ï¼Œè€Œä¸æ˜¯-enum" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨ enum class ï¼Œè€Œä¸æ˜¯ enum"></a>ä¼˜å…ˆä½¿ç”¨ <code>enum class</code> ï¼Œè€Œä¸æ˜¯ <code>enum</code></h3><ol>
<li> <code>enum class</code> å¯ä»¥é¿å… <code>enum</code> å¸¦æ¥çš„å‘½åç©ºé—´æ±¡æŸ“</li>
</ol>
<pre><code class="cpp">enum Color &#123; red, green, blue &#125;;
auto red = false; // Compile errorï¼Œenum Color æ±¡æŸ“äº†å½“å‰çš„å‘½åç©ºé—´

enum class Color &#123; red, green, blue &#125;;
Color c1 = red;        // Compile error
Color c2 = Color::red; // OK
auto  c3 = Color::red; // OK
</code></pre>
<ol start="2">
<li> <code>enum class</code> ä¸èƒ½éšå¼è½¬æ¢ä¸ºå…¶ä»–ç±»å‹</li>
</ol>
<pre><code class="cpp">enum Color &#123; red, green, blue &#125;;
Color c = red;
if (c &lt; 11.4); // OK

enum class Color &#123; red, green, blue &#125;;
Color c = Color::red;
if (c &lt; 11.4) &#123;&#125; // Compile error
</code></pre>
<ol start="3">
<li><code>enum class</code> çš„é»˜è®¤åº•å±‚ç±»å‹æ˜¯ <code>int</code> ï¼Œè€Œ <code>enum</code> æ²¡æœ‰é»˜è®¤åº•å±‚ç±»å‹ï¼ˆèŠ‚çœç©ºé—´ï¼‰<br> è¿™æ„å‘³ <code>enum</code> ä»…åœ¨æŒ‡å®šåº•å±‚ç±»å‹çš„æƒ…å†µä¸‹æ‰å¯ä»¥è¿›è¡Œå‰ç½®å£°æ˜ï¼›åŒæ—¶é»˜è®¤æƒ…å†µä¸‹ï¼Œè‹¥ <code>enum</code> çš„å®šä¹‰å‘ç”Ÿæ‰©å……ï¼ˆä¾‹å¦‚æ–°å¢äº†ä¸€ä¸ªæšä¸¾ï¼‰ï¼Œ <code>enum</code> çš„åº•å±‚ç±»å‹å°±å¯èƒ½ä¼šæ”¹å˜ï¼Œä¾èµ–åˆ° <code>enum</code> çš„ç¼–è¯‘å•å…ƒéƒ½éœ€è¦é‡æ–°ç¼–è¯‘äº†</li>
</ol>
<h3 id="ä¸ºéœ€è¦æ”¹å†™çš„å‡½æ•°éƒ½æ˜¾å¼æ·»åŠ -override-å£°æ˜"><a href="#ä¸ºéœ€è¦æ”¹å†™çš„å‡½æ•°éƒ½æ˜¾å¼æ·»åŠ -override-å£°æ˜" class="headerlink" title="ä¸ºéœ€è¦æ”¹å†™çš„å‡½æ•°éƒ½æ˜¾å¼æ·»åŠ  override å£°æ˜"></a>ä¸ºéœ€è¦æ”¹å†™çš„å‡½æ•°éƒ½æ˜¾å¼æ·»åŠ  <code>override</code> å£°æ˜</h3><p>å‘ç”Ÿå‡½æ•°é‡è½½æ˜¯éœ€è¦ä¸€äº›æ¡ä»¶çš„ï¼š</p>
<ul>
<li><p>å‡½æ•°åç§°ç›¸åŒ</p>
</li>
<li><p>å½¢å‚ç±»å‹ç›¸åŒ</p>
</li>
<li><p>å¸¸é‡æ€§ç›¸åŒ</p>
</li>
<li><p>è¿”å›å€¼å’Œå¼‚å¸¸ç±»å‹å¯å…¼å®¹</p>
</li>
<li><p>å‡½æ•°å¼•ç”¨é™å®šç¬¦ï¼ˆC++11ï¼Œç”¨äºé™åˆ¶å‡½æ•°ä»…ç”¨äºå·¦å€¼æˆ–å³å€¼ï¼‰ç›¸åŒ</p>
</li>
</ul>
<p>åœ¨ç¼–å†™é‡å†™çš„å‡½æ•°æ—¶ï¼Œå¯èƒ½ä¼šå› ä¸ºæŸäº›æ¡ä»¶æ²¡æœ‰æ»¡è¶³å¯¼è‡´æ²¡æœ‰çœŸæ­£é‡å†™ï¼ˆæœ‰å¯èƒ½å‘ç”Ÿ function shadowingï¼‰ï¼Œè¿™æ—¶å€™åŠ ä¸Š <code>override</code> å°±èƒ½è®©ç¼–è¯‘å™¨äº§ç”Ÿé”™è¯¯ä¿¡æ¯äº†ã€‚</p>
<h3 id="ä¼˜å…ˆä½¿ç”¨-const-iterator-ï¼Œè€Œä¸æ˜¯-iterator"><a href="#ä¼˜å…ˆä½¿ç”¨-const-iterator-ï¼Œè€Œä¸æ˜¯-iterator" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨ const_iterator ï¼Œè€Œä¸æ˜¯ iterator"></a>ä¼˜å…ˆä½¿ç”¨ <code>const_iterator</code> ï¼Œè€Œä¸æ˜¯ <code>iterator</code></h3><p><code>const_iterator</code> å’Œ <code>iterator</code> æœ¬è´¨ä¸Šéƒ½æ˜¯ <code>normal_iterator</code> çš„ aliasï¼ŒåŒºåˆ«åœ¨äº <code>_Iterator</code> ç±»å‹çš„ä¸åŒï¼ˆ <code>pointer</code> å’Œ <code>const_pointer</code> ï¼‰</p>
<pre><code class="cpp">// libstdc++: stl_vector.h
// https://gcc.gnu.org/onlinedocs/gcc-4.8.2/libstdc++/api/a01570_source.html

227: typedef __gnu_cxx::__normal_iterator&lt;pointer, vector&gt; iterator;
228: typedef __gnu_cxx::__normal_iterator&lt;const_pointer, vector&gt; const_iterator;

// libstdc++: stl_iterator.h
// https://gcc.gnu.org/onlinedocs/gcc-6.3.0/libstdc++/api/a01623_source.html
756: template&lt;typename _Iterator, typename _Container&gt;
757:    class __normal_iterator
758:    &#123;
759:     protected:
760:      _Iterator _M_current;
761:
762:      typedef iterator_traits&lt;_Iterator&gt; __traits_type;
</code></pre>
<p><code>const_iterator</code> ä¸èƒ½ç”¨äºä¿®æ”¹å®¹å™¨å…ƒç´ ï¼Œå› æ­¤ï¼Œåœ¨ä¸éœ€è¦é€šè¿‡è¿­ä»£å™¨ä¿®æ”¹å˜é‡çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨ <code>const</code> ç‰ˆæœ¬çš„è¿­ä»£å™¨ç›¸å…³çš„æˆå‘˜å‡½æ•°ï¼ˆä¾‹å¦‚ <code>cbegin()</code> ã€ <code>cend()</code> ï¼‰ã€‚</p>
<p>ä¸è¿‡ï¼Œåœ¨å®¹å™¨æœ¬èº«å°±ä½¿ç”¨ <code>const</code> ä¿®é¥°çš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨å…¶æ™®é€šç‰ˆæœ¬çš„è¿­ä»£å™¨ç›¸å…³å‡½æ•°ï¼ˆä¾‹å¦‚ <code>begin()</code> ï¼‰ä¹Ÿä¼šè¿”å› <code>const_iterator</code> ï¼Œå…·ä½“æƒ…å†µå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="cpp">// https://godbolt.org/z/jj5e77T3Y

vector&lt;int&gt; v;
const vector&lt;int&gt; cv = v;

v.begin();   // type: __gnu_cxx::__normal_iterator&lt;int*, std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;
v.cbegin();  // type: __gnu_cxx::__normal_iterator&lt;int const*, std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;
cv.begin();  // type: __gnu_cxx::__normal_iterator&lt;int const*, std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;
cv.cbegin(); // type: __gnu_cxx::__normal_iterator&lt;int const*, std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;

int target = 0; // Readonly find
const auto it1 = find(v.begin(), v.end(), target);     // Bad
const auto it2 = find(v.cbegin(), v.cend(), target);   // Good
const auto it3 = find(cv.begin(), cv.end(), target);   // Acceptable
const auto it4 = find(cv.cbegin(), cv.cend(), target); // Good
</code></pre>
<p>å› æ­¤ï¼Œ</p>
<ul>
<li><p>å¯¹äºé <code>const</code> å®¹å™¨å˜é‡ï¼Œåœ¨ä¸é€šè¿‡è¿­ä»£å™¨ä¿®æ”¹å˜é‡çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>const</code> ç‰ˆæœ¬çš„è¿­ä»£å™¨ç›¸å…³æˆå‘˜å‡½æ•°</p>
</li>
<li><p>å¯¹äº <code>const</code> å®¹å™¨å˜é‡ï¼Œåˆ™éƒ½å¯ä»¥æ¥å—ï¼Œä½†è¿˜æ˜¯å°½é‡ä½¿ç”¨ <code>const</code> çš„ç‰ˆæœ¬ï¼ˆå› ä¸ºå®¹å™¨çš„ constness å¯èƒ½ä¼šåœ¨åç»­çš„ä»£ç æ”¹åŠ¨ä¸­å‘ç”Ÿå˜åŒ–ï¼‰</p>
</li>
</ul>
<h3 id="ç¡®å®šå‡½æ•°ä¸ä¼šå¼‚å¸¸åï¼Œå¯ä»¥åŠ ä¸Š-noexcept-å£°æ˜"><a href="#ç¡®å®šå‡½æ•°ä¸ä¼šå¼‚å¸¸åï¼Œå¯ä»¥åŠ ä¸Š-noexcept-å£°æ˜" class="headerlink" title="ç¡®å®šå‡½æ•°ä¸ä¼šå¼‚å¸¸åï¼Œå¯ä»¥åŠ ä¸Š noexcept å£°æ˜"></a>ç¡®å®šå‡½æ•°ä¸ä¼šå¼‚å¸¸åï¼Œå¯ä»¥åŠ ä¸Š <code>noexcept</code> å£°æ˜</h3><ol>
<li><p>åŠ ä¸Š <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/noexcept_spec"><code>noexcept</code></a> å£°æ˜æœ‰åˆ©äºå‡½æ•°ç¼–è¯‘å™¨æ›´å¥½åœ°ä¼˜åŒ–ä»£ç </p>
</li>
<li><p>ç¼–å†™ç±»çš„ç§»åŠ¨æ„é€ å‡½æ•°æ—¶ï¼ŒåŠ ä¸Š <code>noexcept</code> å£°æ˜å¯ä»¥åœ¨å…¶ä½œä¸º <code>vector</code> ç­‰å®¹å™¨çš„å…ƒç´ æ—¶ï¼Œåœ¨å®¹å™¨å‘ç”Ÿ resize çš„æƒ…å†µä¸‹ï¼Œå°†å…ƒç´ çš„å¤åˆ¶æ“ä½œæ›¿æ¢æˆä½æˆæœ¬çš„ç§»åŠ¨æ“ä½œ</p>
</li>
<li><p>å¤§éƒ¨åˆ†å‡½æ•°æ˜¯å¼‚å¸¸ä¸­ç«‹çš„ï¼Œå‡½æ•°æœ¬èº«ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œä½†å…¶è°ƒç”¨çš„å‡½æ•°ä¸ä¿è¯ä¸äº§ç”Ÿå¼‚å¸¸ï¼ˆåœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç ä¸­ï¼Œæ¶‰åŠ RPC è°ƒç”¨çš„ä»£ç åŸºæœ¬éƒ½å±äºè¿™ç§æƒ…å†µï¼Œå¯èƒ½åªæœ‰å°‘éƒ¨åˆ†å·¥å…·ç±»ä»£ç å¯ä¿è¯ä¸äº§ç”Ÿå¼‚å¸¸ï¼‰</p>
</li>
</ol>
<h3 id="ä¼˜å…ˆä½¿ç”¨-constexpr-ï¼Œè€Œä¸æ˜¯-const"><a href="#ä¼˜å…ˆä½¿ç”¨-constexpr-ï¼Œè€Œä¸æ˜¯-const" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨ constexpr ï¼Œè€Œä¸æ˜¯ const"></a>ä¼˜å…ˆä½¿ç”¨ <code>constexpr</code> ï¼Œè€Œä¸æ˜¯ <code>const</code></h3><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/constexpr"><code>constexpr</code></a> æ˜¯ C++11 å¼•å…¥çš„ç¼–è¯‘æœŸå¸¸é‡è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ï¼Œç›¸æ¯”è€Œè¨€ <code>const</code> åˆ™ä»…ä¿è¯æŸä¸ªå˜é‡åœ¨è¿è¡Œæ—¶ä¿æŒä¸å˜ã€‚å…·å¤‡ç¼–è¯‘æœŸå¯çŸ¥çš„ç‰¹æ€§ä¹‹åï¼Œç”¨ <code>constexpr</code> ä¿®é¥°çš„å˜é‡å°±å¯ä»¥ç”¨äºæ ‡è¯†æ•°ç»„å¤§å°ã€switch case label ç­‰åœºæ™¯äº†ã€‚</p>
<pre><code class="cpp">// https://godbolt.org/z/fWEn4Kcfb

// constexpr ç”¨äºå‡½æ•°æ—¶ï¼Œè¡¨æ˜å‡½æ•°æœ¬èº«çš„â€œæ¨æ–­è¡Œä¸ºâ€ç¼–è¯‘æœŸå¯çŸ¥ï¼š
//  - å½“å‡½æ•°æ¥å— constexpr å…¥å‚æ—¶ï¼Œè¿”å› constexpr å¸¸é‡
//  - å½“å‡½æ•°æ¥å—é constexpr å…¥å‚æ—¶ï¼Œä¹Ÿè¿”å›é constexpr å˜é‡
constexpr int get_compile_time_value(int x) &#123;
    return x;
&#125;

int get_runtime_value() &#123;
    return 0;
&#125;

int main() &#123;
// constexpr ç”¨äºå˜é‡æ—¶ï¼Œä»…èƒ½ä¿®é¥°ç¼–è¯‘æœŸå¸¸é‡
    constexpr int x = get_runtime_value(); // Compile error

    constexpr int a = 0x114;
    constexpr int y = get_compile_time_value(a); // OK

    int b = 0x514;
    constexpr int z = get_compile_time_value(b); // Compile error
&#125;
</code></pre>
<p>C++11 ä¸­ï¼Œ <code>constexpr</code> å‡½æ•°æœ€å¤šåªèƒ½åŒ…å«ä¸€æ¡å¯æ‰§è¡Œè¯­å¥ï¼Œå³ <code>return</code> è¯­å¥ï¼›C++14 ä»¥åä¸å†æœ‰è¿™ä¸ªé™åˆ¶ã€‚</p>
<p>C++11 ä¸­ï¼Œ <code>constexpr</code> æˆå‘˜å‡½æ•°ä¼šè¢«éšå¼åœ°åŠ ä¸Š <code>const</code> ä¿®é¥°ç¬¦ï¼Œæ­¤æ—¶ <code>constexpr</code> æˆå‘˜å‡½æ•°ä¸èƒ½ç”¨äºä¿®æ”¹ç±»çš„æˆå‘˜å˜é‡ï¼ˆå½“ç„¶å¯ä»¥é€šè¿‡ <code>mutable</code> è§„é¿ï¼‰ï¼›C++14 ä»¥åä¸å†æœ‰è¿™ä¸ªé™åˆ¶ã€‚</p>
<h3 id="C-11-ç±»æˆå‘˜å‡½æ•°çš„ç”Ÿæˆæœºåˆ¶"><a href="#C-11-ç±»æˆå‘˜å‡½æ•°çš„ç”Ÿæˆæœºåˆ¶" class="headerlink" title="C++11 ç±»æˆå‘˜å‡½æ•°çš„ç”Ÿæˆæœºåˆ¶"></a>C++11 ç±»æˆå‘˜å‡½æ•°çš„ç”Ÿæˆæœºåˆ¶</h3><pre><code class="cpp">// https://godbolt.org/z/xqKK6a5e4

class Clazz &#123;
 public:
  // é»˜è®¤æ„é€ å‡½æ•°
  // ä»…å½“ç±»ä¸­æ²¡æœ‰æ˜¾å¼å£°æ˜ä»»ä½•æ„é€ å‡½æ•°æ—¶æ‰ç”Ÿæˆ
  Clazz();

  // ææ„å‡½æ•°
  // 1. ææ„å‡½æ•°é»˜è®¤ä¸º noexcept
  // 2. ä»…å½“åŸºç±»çš„ææ„å‡½æ•°ä¸ºè™šæ—¶ï¼Œæ´¾ç”Ÿç±»é»˜è®¤ç”Ÿæˆçš„ææ„å‡½æ•°æ‰æ˜¯è™šçš„
  ~Clazz();

  // å¤åˆ¶æ„é€ å‡½æ•°/èµ‹å€¼è¿ç®—ç¬¦
  // 1. é»˜è®¤ç”Ÿæˆçš„å¤åˆ¶æ„é€ å‡½æ•°å°†ä¼šä¾æ¬¡è°ƒç”¨éé™æ€ç±»æˆå‘˜å˜é‡çš„å¤åˆ¶æ„é€ å‡½æ•°
  // 2. å¤åˆ¶æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦**ç›¸äº’ç‹¬ç«‹**ï¼Œå£°æ˜äº†å…¶ä¸­ä¸€ä¸ªå¹¶ä¸ä¼šé˜»æ­¢ç¼–è¯‘å™¨ç”Ÿæˆå¦ä¸€ä¸ª
  // 3. æ˜¾å¼å£°æ˜ç§»åŠ¨æ“ä½œä¼šå¯¼è‡´ç¼–è¯‘å™¨**åˆ é™¤**å¤åˆ¶æ“ä½œ
  //    æ˜¾å¼å£°æ˜ç§»åŠ¨æ“ä½œçš„ç±»ï¼Œå¯èƒ½æ˜¯ä¸å¯å¤åˆ¶çš„ï¼Œä¾‹å¦‚ unique_ptr
  Clazz(const Clazz &amp;rhs);
  Clazz&amp; operator=(const Clazz &amp;rhs);

  // ç§»åŠ¨æ„é€ å‡½æ•°/èµ‹å€¼è¿ç®—ç¬¦
  // 1. é»˜è®¤ç”Ÿæˆçš„ç§»åŠ¨æ„é€ å‡½æ•°å°†ä¼šä¾æ¬¡è°ƒç”¨éé™æ€ç±»æˆå‘˜å˜é‡çš„ç§»åŠ¨æ„é€ å‡½æ•°
  //    è‹¥æˆå‘˜ä¸å¯ç§»åŠ¨ï¼Œåˆ™è°ƒç”¨å…¶å¤åˆ¶æ„é€ å‡½æ•°
  // 2. ç§»åŠ¨æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦**ä¸ç›¸äº’ç‹¬ç«‹**
  //    å½“æ˜¾å¼å£°æ˜ç§»åŠ¨æ“ä½œæ—¶ï¼Œè¯´æ˜ä½ å¾ˆå¯èƒ½åœ¨é»˜è®¤å®ç°çš„åŸºç¡€ä¸Šè¿˜éœ€è¦è¿›è¡Œå…¶ä»–çš„æ“ä½œï¼Œ
  //    å› æ­¤ç¼–è¯‘å™¨ç”Ÿæˆçš„ç‰ˆæœ¬å¾ˆæœ‰å¯èƒ½æ˜¯ä¸é€‚ç”¨çš„
  // 3. æ˜¾å¼å£°æ˜å¤åˆ¶æ“ä½œæˆ–ææ„å‡½æ•°ä¼šé˜»æ­¢ç¼–è¯‘å™¨ç”Ÿæˆç§»åŠ¨æ“ä½œ
  //    å£°æ˜å¤åˆ¶æ“ä½œè¡¨æ˜ç¼–è¯‘å™¨çš„é»˜è®¤å®ç°ï¼ˆæŒ‰æˆå‘˜å¤åˆ¶ï¼‰ä¸é€‚ç”¨ï¼Œè€Œç§»åŠ¨æ“ä½œçš„é»˜è®¤å®ç°å¾ˆå¯èƒ½
  //    åŒ…å«æˆå‘˜çš„å¤åˆ¶æ“ä½œï¼Œå› æ­¤å¤§æ¦‚ç‡ä¹Ÿæ˜¯ä¸é€‚ç”¨çš„
  Clazz(Clazz &amp;&amp;rhs);
  Clazz&amp; operator=(Clazz&amp;&amp; rhs);
&#125;;
</code></pre>
<p>ç±»æˆå‘˜å‡½æ•°ç”Ÿæˆè§„åˆ™æ€»ç»“ï¼š</p>
<p><img src="https://img.picgo.net/2022/11/25/Untitled-10a41462db2a09e61.png" alt="member-function-generation.png"></p>
<p>ç±»æˆå‘˜å‡½æ•°ç”Ÿæˆç‰¹å¾ï¼š</p>
<ol>
<li><p>å½“ç”Ÿæˆæ´¾ç”Ÿç±»çš„ææ„å‡½æ•°æ—¶ï¼Œè‹¥åŸºç±»çš„ææ„å‡½æ•°æ˜¯ä¸ªè™šå‡½æ•°ï¼Œåˆ™æ´¾ç”Ÿç±»ç”Ÿæˆçš„ææ„å‡½æ•°ä¹Ÿæ˜¯è™šå‡½æ•°</p>
</li>
<li><p>å…¶ä»–æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„æˆå‘˜å‡½æ•°éƒ½æ˜¯ <code>public</code> ä¸” <code>inline</code> çš„</p>
</li>
</ol>
<p>å¦å¤–ï¼Œæˆå‘˜å‡½æ•°æ¨¡æ¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šæŠ‘åˆ¶æˆå‘˜å‡½æ•°çš„ç”Ÿæˆã€‚</p>
<h3 id="ä½¿ç”¨-auto"><a href="#ä½¿ç”¨-auto" class="headerlink" title="ä½¿ç”¨ auto"></a>ä½¿ç”¨ <code>auto</code></h3><p>åœ¨ <code>clangd</code> + <code>clang-format</code> + <code>clang-tidy</code> çš„åŠ æŒä¸‹ï¼Œå»ºè®®å¤šä½¿ç”¨ <code>auto</code> è€Œä¸æ˜¯æ˜¾å¼åœ°å£°æ˜å˜é‡ç±»å‹</p>
<ol>
<li><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ éƒ½å¾ˆç¡®å®šè¿™ä¸ªç±»å‹æ˜¯å•¥ï¼Œä¾‹å¦‚ <code>const auto it = std::find(...);</code> ï¼Œæ²¡æœ‰å¿…è¦æ˜¾å¼æŠŠå˜é‡ç±»å‹æ ‡è¯†å‡ºæ¥ï¼›clangd ä¼šæ˜¾ç¤º <code>it</code> çš„æ¨å¯¼ç±»å‹ï¼ŒCode reviewer åœ¨è¿™ç§æƒ…å†µä¸‹ç›¸ä¿¡ä¹Ÿä¸ä¼šå› ä¸º <code>auto</code> è€Œå›°æƒ‘</p>
</li>
<li><p>å°‘éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ å…¶å®å¹¶ä¸çœŸçš„çŸ¥é“å‡½æ•°è¿”å›çš„ç±»å‹ï¼Œè¿™æ—¶å€™ <code>auto</code> èƒ½é™ä½ä½ çš„ä¸€äº›å¿ƒç†è´Ÿæ‹…ï¼Œé¿å…ä¸€äº›ä»£ç é—®é¢˜ï¼ˆä¸è¿‡è¿™é‡Œå°±æœ‰åˆ©æœ‰å¼Šäº†ï¼‰</p>
</li>
</ol>
<pre><code class="cpp">// https://godbolt.org/z/ocdvT6G7P
// Case 1
unordered_map&lt;int, string&gt; m = &#123;&#123;0x1, "Hello"&#125;&#125;;
for (const auto &amp;kv : m) &#123; // Good
    // kv.first ä¸º int const ç±»å‹ï¼Œè€Œé int ç±»å‹
&#125;

// å­˜åœ¨éšå¼è½¬æ¢ï¼Œé€ æˆå¤šä½™çš„æ€§èƒ½æŸå¤±
for (const pair&lt;int, string&gt; &amp;kv : m) &#123;...&#125; // Bad
// C++17 ç»“æ„åŒ–ç»‘å®š
for (const auto &amp;[k, v] : m) &#123;...&#125; // Good, I love it

// Case 2
vector&lt;bool&gt; v = &#123;false, true&#125;;
const auto first = v.at(0); // Bad, or use static_cast later
// first ä¸º std::_Bit_reference ç±»å‹ï¼Œè€Œé bool ç±»å‹
// ref: https://en.cppreference.com/w/cpp/container/vector_bool
const bool first = v.at(0); // Implicitly transformed
</code></pre>
<h3 id="ä½¿ç”¨-std-function-ä»£æ›¿å‡½æ•°æŒ‡é’ˆ"><a href="#ä½¿ç”¨-std-function-ä»£æ›¿å‡½æ•°æŒ‡é’ˆ" class="headerlink" title="ä½¿ç”¨ std::function ä»£æ›¿å‡½æ•°æŒ‡é’ˆ"></a>ä½¿ç”¨ <code>std::function</code> ä»£æ›¿å‡½æ•°æŒ‡é’ˆ</h3><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/utility/functional/function"><code>std::function</code></a> æ˜¯ C++11 æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡æ¿ï¼Œå°†å‡½æ•°æŒ‡é’ˆçš„æ€æƒ³æ¨å¹¿ä¸ºä»»ä½•çš„å¯è°ƒç”¨å¯¹è±¡ï¼ˆå³é‡è½½äº† <code>()</code> æ“ä½œç¬¦çš„å¯¹è±¡ï¼‰ã€‚ç›¸æ¯”å‡½æ•°æŒ‡é’ˆï¼Œå…¶é€‚ç”¨æ€§æ›´å¹¿ï¼Œä»£ç å¯è¯»æ€§ä¹Ÿæ›´å¥½ï¼Œè¿˜å¯ä»¥è·Ÿ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/utility/functional/bind"><code>std::bind</code></a> ã€ <a target="_blank" rel="noopener" href="https://github.com/abseil/abseil-cpp/blob/master/absl/functional/bind_front.h"><code>absl::bind_front</code></a> ã€ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/lambda">Lambda è¡¨è¾¾å¼</a>ç­‰ç‰¹æ€§ç»“åˆã€‚</p>
<h3 id="ä½¿ç”¨-chrono-æ—¶é—´å·¥å…·åº“"><a href="#ä½¿ç”¨-chrono-æ—¶é—´å·¥å…·åº“" class="headerlink" title="ä½¿ç”¨ chrono æ—¶é—´å·¥å…·åº“"></a>ä½¿ç”¨ <code>chrono</code> æ—¶é—´å·¥å…·åº“</h3><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/chrono">chrono</a> æ—¶é—´å·¥å…·åº“ç›¸æ¯” <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/chrono/c/time"><code>std::time</code></a> ä¸ç®¡æ˜¯ä»è¡¨è¾¾åŠ›è¿˜æ˜¯ä»æ˜“ç”¨æ€§ä¸Šéƒ½å¥½å¾ˆå¤šï¼Œ<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/chrono/duration#Literals">chrono_literals</a> çš„åŠ å…¥æ›´æ˜¯è®©ä»£ç å¯è¯»æ€§æ›´ä¸Šä¸€ä¸ªå°é˜¶ã€‚æ—¥å¸¸ä¸šåŠ¡å¼€å‘ä¸­æˆ‘ä»¬æ—¶å¸¸ä¼šæœ‰è®¡ç®—æŸæ®µå­ä¾‹ç¨‹æ‰§è¡Œæ—¶é—´çš„éœ€æ±‚ï¼Œè¿™æ—¶å€™ç”¨ chrono å°±å¾ˆåˆé€‚ã€‚</p>
<pre><code class="cpp">#include &lt;chrono&gt;

auto start = std::chrono::steady_clock::now();
// Doing stuffs changing the world
auto end = std::chrono::steady_clock::now();

std::chrono::duration&lt;double&gt; elapsed_seconds = end - start;
// Report
</code></pre>
<h3 id="å°è¯•ä½¿ç”¨-Trailing-return-type"><a href="#å°è¯•ä½¿ç”¨-Trailing-return-type" class="headerlink" title="å°è¯•ä½¿ç”¨ Trailing return type"></a>å°è¯•ä½¿ç”¨ Trailing return type</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/function">Trailing return type</a> æ˜¯ C++11 å¼•å…¥çš„å‡½æ•°è¿”å›å€¼å£°æ˜è¯­æ³•ï¼Œç›¸æ¯”å¸¸è§„çš„å‡½æ•°å£°æ˜è¯­æ³•æ›´èƒ½çªæ˜¾å‡½æ•°çš„è¿”å›ç±»å‹ã€‚</p>
<pre><code class="cpp">char const *func1(void f(bool&amp;));
auto func2(void f(bool&amp;)) -&gt; char const*;
</code></pre>
</li>
<li><p>å¦‚æœè¿”å›å€¼ç±»å‹æ˜¯é€šè¿‡ <code>decltype</code> å£°æ˜ï¼Œä¸” <code>decltype</code> ä¾èµ–å…¥å‚ï¼Œåˆ™æ­¤æ—¶å¿…é¡»ä½¿ç”¨ Trailing return type</p>
<pre><code class="cpp">decltype(a.end()) end_1(const vector&lt;int&gt; &amp;a) &#123; // Compile error
  return a.end();
&#125;

auto end_2(const vector&lt;int&gt; &amp;a) -&gt; decltype(a.end()) &#123; // OK
  return a.end();
&#125;

decltype(auto) end_3(const vector&lt;int&gt; &amp;a) &#123; // OK since C++14
  return a.end();
&#125;
</code></pre>
</li>
</ul>
<h3 id="å¼€å§‹ä½¿ç”¨-Attribute"><a href="#å¼€å§‹ä½¿ç”¨-Attribute" class="headerlink" title="å¼€å§‹ä½¿ç”¨ Attribute"></a>å¼€å§‹ä½¿ç”¨ <code>Attribute</code></h3><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/attributes">Attribute specifier sequence</a> æ˜¯ C++11 å¼€å§‹å¼•å…¥çš„ç”¨äºå¢å¼ºè¯­ä¹‰æˆ–è¿›è¡Œç¼–è¯‘å™¨ hint çš„ç‰¹æ€§ï¼Œä»¥ä¸‹åˆ—ä¸¾å‡ ä¸ªå¯ä»¥å¼€å§‹å°è¯•çš„ attributesï¼Œå…·ä½“å¯ä»¥è‡ªå·±å¤šåŠ æ¢ç´¢ï¼ˆå®é™…ä¸Šå°±æ˜¯æˆ‘æ‰ç–å­¦æµ…ï¼Œç”¨çš„ä¸å¤šï¼‰ã€‚</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/attributes/nodiscard"><code>[[nodiscard]]</code></a> (since C++17) ç›®å‰è§‰å¾—æœ€å¥½ç”¨çš„ attributeï¼Œå¯ä»¥ç”¨äºä¿®é¥°å‡½æ•°ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°çš„è¿”å›å€¼ä¸å¯å¿½ç•¥ï¼Œå¯¹äºä¸šåŠ¡ä»£ç ä¸­å¸¸ç”¨ <code>ret</code> ä½œä¸ºè¿”å›å€¼çš„åœºæ™¯è¿˜æ˜¯æ¯”è¾ƒæœ‰å¸®åŠ©çš„ï¼›ç‰¹åˆ«æ˜¯å¯¹äºå¸¦è¿”å›å€¼çš„çº¯å‡½æ•°ï¼ˆä¾‹å¦‚ const æˆå‘˜å‡½æ•°ï¼‰ï¼Œå¦‚æœå¿½ç•¥äº†è¿”å›å€¼ï¼Œé‚£å®é™…ä¸Šè°ƒç”¨è¿™ä¸ªå‡½æ•°åŸºæœ¬æ˜¯æ— æ„ä¹‰çš„ï¼ˆå…ˆä¸è€ƒè™‘ä¿®æ”¹ mutable æˆå‘˜å˜é‡çš„æƒ…å†µï¼‰</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/22767523/what-inline-attribute-always-inline-means-in-the-function"><code>[[gnu::always_inline]]</code></a> (GCC) é…åˆ <code>inline</code> ä½¿ç”¨ï¼Œå¼ºåˆ¶å†…è”</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/attributes/deprecated"><code>[[deprecated]]</code></a> (since C++14)</p>
</li>
</ul>
<h3 id="å¤šç”¨-lt-algorithm-gt-ä»£æ›¿æ‰‹æ’¸å°è½®å­"><a href="#å¤šç”¨-lt-algorithm-gt-ä»£æ›¿æ‰‹æ’¸å°è½®å­" class="headerlink" title="å¤šç”¨ &lt;algorithm&gt; ä»£æ›¿æ‰‹æ’¸å°è½®å­"></a>å¤šç”¨ <code>&lt;algorithm&gt;</code> ä»£æ›¿æ‰‹æ’¸å°è½®å­</h3><p><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/algorithm"><code>&lt;algorithm&gt;</code></a> åº“é‡Œæœ‰å¾ˆå¤šå®è—ï¼ˆ <code>std::find_if</code> ã€ <code>std::lower_bound</code> ã€ <code>std::includes</code> â€¦ï¼‰ï¼Œç»†å¿ƒçš„äººæ‰çœ‹å¾—åˆ°ã€‚</p>
<h3 id="C-11-å¹¶å‘åº“"><a href="#C-11-å¹¶å‘åº“" class="headerlink" title="C++11 å¹¶å‘åº“"></a>C++11 å¹¶å‘åº“</h3><p>C++11 å¼€å§‹å¼•å…¥ <code>std::thread</code> ï¼Œç›¸æ¯” <a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man7/pthreads.7.html">pthread</a> æŠ½è±¡å±‚çº§æ›´é«˜ï¼Œæ›´æ˜“ç”¨ï¼ŒåŒæ—¶è¿˜æœ‰å…¶ä»–è¯¸å¦‚ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/atomic/atomic"><code>std::atomic</code></a> ã€ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/thread/async"><code>std::async</code></a> ç­‰å¹¶å‘ APIï¼ŒåŠ©åŠ›æœ‰é” / æ— é”çš„å¹¶å‘ç¼–ç¨‹ã€‚ä¸è¿‡å¹¶å‘è¿™ä¸ªè¯é¢˜è¿˜æ˜¯æœ‰ç‚¹å¤ªå¤§äº†ï¼Œæœ¬èœé¸¡ä¹Ÿåªæ˜¯å†™è¿‡ä¸€ç‚¹ demoï¼Œå°±æ¨èä¸€äº›è®¤ä¸ºè¯»è¿‡ï¼ˆæˆ–æ²¡è¯»è¿‡ï¼‰æ„Ÿè§‰è¿˜ä¸é”™çš„æ–‡ç« å’Œä¹¦ç±äº†ã€‚</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://paul.pub/cpp-concurrency/">C++ å¹¶å‘ç¼–ç¨‹ï¼ˆä» C++11 åˆ° C++17ï¼‰</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://paul.pub/cpp-memory-model/">C++ å†…å­˜æ¨¡å‹</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/24301047/answer/83422523">å¦‚ä½•ç†è§£ C++11 çš„å…­ç§ memory orderï¼Ÿ</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://book.douban.com/subject/4130141/">ã€ŠC++ Concurrency in Actionã€‹</a></p>
</li>
</ul>
<h2 id="ä¸‹ä¸€æ­¥"><a href="#ä¸‹ä¸€æ­¥" class="headerlink" title="ä¸‹ä¸€æ­¥"></a>ä¸‹ä¸€æ­¥</h2><p>C++17 â†’ C++20/23 â†’ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/coroutines">Stackless coroutines</a> â†’ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Template_metaprogramming">Template metaprogramming</a> â†’ Compiler â€¦</p>
<p>æœ€å<del><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/31385520">ã€Œç²¾é€š C++ã€</a></del> â æ‹¥æŠ± Rust âœ…</p>
<p>æ„Ÿè°¢ä½ çœ‹åˆ°<del>ï¼ˆæˆ–åˆ’åˆ°ï¼‰</del>è¿™é‡Œ ğŸ¥³ï¼Œå¸Œæœ›å¤§å®¶å¤šå¤šäº¤æµï¼Œå¤šå¤šæŒ‡æ­£ï¼Œåˆ†äº«ä½ çš„å­¦ä¹ è·¯çº¿ã€èµ„æºå’Œæ–¹æ³•ï¼Œåƒæˆ‘è¿™æ ·çš„ C++ èœé¸¡èƒ½æ•‘ä¸€ä¸ªæ˜¯ä¸€ä¸ª ğŸ¤£</p>
</article>
    
    <div id="gitalk-container"></div>
    
  </div>
</div>


<script>
  const gitalk = new Gitalk({
    clientID: "62d9cfd6ee638cc81c5c",
    clientSecret: "63f13373585b9b247297e68da9e522e14802e1fd",
    repo: "Aneureka.github.io",
    owner: "Aneureka",
    admin: "Aneureka",
    id: location.pathname,
    distractionFreeMode: "false",
    language: "zh-CN",
  });

  gitalk.render("gitalk-container");
</script>

 <!-- Footer -->
<footer class="section">
  <div class="container main footer">
    <ul class="contact-list">
      
      <li class="contact-list-item">
        <a href="mailto:aneureka2@gmail.com">Email</a>
        <a href="mailto:aneureka2@gmail.com">ğŸ’Œ</a>
      </li>
      
      <li class="contact-list-item">
        <a target="_blank" rel="noopener" href="https://github.com/aneureka">Github</a>
        <a target="_blank" rel="noopener" href="https://github.com/aneureka">â­ï¸</a>
      </li>
      
      <li class="contact-list-item">
        <a target="_blank" rel="noopener" href="https://twitter.com/Aneureka">Twitter</a>
        <a target="_blank" rel="noopener" href="https://twitter.com/Aneureka">ğŸ¦</a>
      </li>
      
    </ul>
    <div class="copyright">
      æ•£è½çš„å¶å­ Â· 2017 -
      <script>
        document.write(new Date().getFullYear());
      </script>
      Â· <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">ç²¤ICPå¤‡2021087752å·</a>
    </div>
  </div>
</footer>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script>
  hljs.highlightAll();
</script>


  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-56506279-6");
    </script>
  </body>
</html>
